{"ast":null,"code":"import { ref, onMounted } from \"vue\";\nimport axios from \"@/utils/request\";\nimport { getFavoritePictureFromCOS } from '@/utils/cosService';\nimport { ElMessage } from 'element-plus';\nimport { useStore } from 'vuex';\nexport default {\n  __name: 'FavoriteListA',\n  emits: ['dataFromChild'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const currentPage = ref(1);\n    const store = useStore();\n    const userId = store.state.otherUserId;\n    const articleFavoriteData = ref([]);\n    const emits = __emit;\n    const setActive = item => {\n      const name = '文章收藏';\n      const id = item.id;\n      emits('dataFromChild', name, id);\n    };\n\n    // 添加一个锁状态\n    let isLoading = false;\n    async function load() {\n      if (isLoading) return; // 如果已经在加载中，则直接返回不执行新的加载\n      isLoading = true; // 开始加载数据，设置锁状态为true\n      try {\n        if (currentPage.value === 1) {\n          currentPage.value++;\n        }\n        await fetchArticleColumn(currentPage.value);\n        currentPage.value++; // 只有在请求成功完成后才递增页码\n      } catch (error) {\n        console.error(error);\n        ElMessage.error('滚动时的未知错误');\n      } finally {\n        isLoading = false; // 请求完成，无论成功或失败，都释放锁状态\n      }\n    }\n    async function fetchArticleColumn(currentPage) {\n      try {\n        const response = await axios.get(\"/favorite\", {\n          params: {\n            type: 0,\n            page: currentPage,\n            pageSize: 10,\n            userId: userId\n          }\n        });\n        if (response.data.code === 1 && response.data.data.records.length > 0) {\n          const filteredFavorites = response.data.data.records.filter(articleFavorite => articleFavorite.visibility === 1); // 只保留公共可见的文章\n          const updates = filteredFavorites.map(async favorite => {\n            const coverPicture = await getFavoritePictureFromCOS(favorite.id);\n            return {\n              ...favorite,\n              coverPicture\n            };\n          });\n          const updatedFavorites = await Promise.all(updates);\n          articleFavoriteData.value = [...articleFavoriteData.value, ...updatedFavorites];\n        } else if (response.data.code === 1 && response.data.data.records.length === 0) {\n          // ElMessage.info('已加载所有数据');\n        } else if (response.data.code === 0 && response.data.msg) {\n          ElMessage.error(response.data.msg.toString());\n        } else {\n          console.error(\"获取文章收藏数据失败\");\n          ElMessage.error(\"获取文章收藏数据失败\");\n        }\n      } catch (error) {\n        console.error(\"获取文章收藏数据失败\", error);\n        ElMessage.error(\"获取文章收藏数据失败\");\n      }\n    }\n    onMounted(async () => {\n      fetchArticleColumn(currentPage.value);\n    });\n    const __returned__ = {\n      currentPage,\n      store,\n      userId,\n      articleFavoriteData,\n      emits,\n      setActive,\n      get isLoading() {\n        return isLoading;\n      },\n      set isLoading(v) {\n        isLoading = v;\n      },\n      load,\n      fetchArticleColumn,\n      ref,\n      onMounted,\n      get axios() {\n        return axios;\n      },\n      get getFavoritePictureFromCOS() {\n        return getFavoritePictureFromCOS;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get useStore() {\n        return useStore;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","axios","getFavoritePictureFromCOS","ElMessage","useStore","currentPage","store","userId","state","otherUserId","articleFavoriteData","emits","__emit","setActive","item","name","id","isLoading","load","value","fetchArticleColumn","error","console","response","get","params","type","page","pageSize","data","code","records","length","filteredFavorites","filter","articleFavorite","visibility","updates","map","favorite","coverPicture","updatedFavorites","Promise","all","msg","toString"],"sources":["D:/有渔/前端源码/YouyuBBS-Q - 副本/youyu-lyn-qtnew-vision-new-2024.1.14/src/page/OtherUserPersonalpage/articleFavorite/FavoriteListA.vue"],"sourcesContent":["<template>\r\n    <div class=\"cbutton\">\r\n        <span class=\"tatitle\">TA的文章收藏</span>\r\n    </div>\r\n    <div class=\"hh\" v-infinite-scroll=\"load\" infinite-scroll-distance=\"100\" infinite-scroll-immediate=\"false\">\r\n        <div class=\"show\" v-for=\"item in articleFavoriteData\" :key=\"item.id\">\r\n            <div style=\"display: flex;flex-direction: column;justify-content: space-between;height: 100%;\">\r\n                <span class=\"title\">{{ item.name }}</span>\r\n                <span class=\"content multi-line-ellipsis-2 \">{{ item.profile }}</span>\r\n                <div class=\"more\">\r\n                    <span class=\"time\">创建时间{{ item.createTime }}</span>\r\n                    <span class=\"time\">文章数量 {{ item.number }}</span>\r\n                    <span class=\"time\">获赞数 {{ item.likeCount }}</span>\r\n                    <span class=\"text\"  @click=\"setActive(item)\">查看文章内容</span>\r\n                </div>\r\n            </div>\r\n            <img :src=\"item.coverPicture\" alt=\"\" class=\"carepic\" />\r\n        </div>\r\n        <el-empty \r\n            v-if=\"articleFavoriteData.length === 0 || !articleFavoriteData\" \r\n            :image-size=\"200\" \r\n            description=\"他还没有文章收藏夹呢，逛逛别的吧！\"\r\n        />\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\n  import { ref, onMounted,defineEmits } from \"vue\";\r\n  import axios from \"@/utils/request\";\r\n  import { getFavoritePictureFromCOS } from '@/utils/cosService';\r\n  import { ElMessage } from 'element-plus';\r\n  import { useStore } from 'vuex';\r\n\r\n  const currentPage = ref(1);\r\n  const store = useStore();\r\n  const userId = store.state.otherUserId;\r\n  const articleFavoriteData = ref([]);\r\n  const emits = defineEmits(['dataFromChild']);\r\n  const setActive = (item) => {\r\n      const name = '文章收藏';\r\n      const id = item.id;\r\n      emits('dataFromChild', name,id);\r\n  }\r\n\r\n  // 添加一个锁状态\r\n  let isLoading = false;\r\n  async function load() {\r\n      if (isLoading) return; // 如果已经在加载中，则直接返回不执行新的加载\r\n      isLoading = true; // 开始加载数据，设置锁状态为true\r\n      try {\r\n          if(currentPage.value === 1){\r\n              currentPage.value++;\r\n          }\r\n          await fetchArticleColumn(currentPage.value);\r\n          currentPage.value++; // 只有在请求成功完成后才递增页码\r\n      } catch (error) {\r\n          console.error(error);\r\n          ElMessage.error('滚动时的未知错误');\r\n      } finally {\r\n          isLoading = false; // 请求完成，无论成功或失败，都释放锁状态\r\n      }\r\n  }\r\n\r\n  async function fetchArticleColumn(currentPage) {\r\n    try {\r\n        const response = await axios.get(\"/favorite\", {\r\n        params: {\r\n            type: 0,\r\n            page: currentPage,\r\n            pageSize: 10, \r\n            userId: userId,\r\n        }\r\n        });\r\n        if (response.data.code === 1 && response.data.data.records.length > 0) {\r\n        const filteredFavorites = response.data.data.records.filter(articleFavorite => articleFavorite.visibility === 1); // 只保留公共可见的文章\r\n        const updates = filteredFavorites.map(async (favorite) => {\r\n            const coverPicture = await getFavoritePictureFromCOS(favorite.id);\r\n            return {\r\n            ...favorite,\r\n            coverPicture\r\n            };\r\n        });\r\n        const updatedFavorites = await Promise.all(updates);\r\n        articleFavoriteData.value = [...articleFavoriteData.value, ...updatedFavorites];\r\n        } else if (response.data.code === 1 && response.data.data.records.length === 0) {\r\n        // ElMessage.info('已加载所有数据');\r\n        } else if (response.data.code === 0 && response.data.msg) {\r\n        ElMessage.error(response.data.msg.toString());\r\n        } else {\r\n        console.error(\"获取文章收藏数据失败\");\r\n        ElMessage.error(\"获取文章收藏数据失败\");\r\n        }\r\n    } catch (error) {\r\n        console.error(\"获取文章收藏数据失败\", error);\r\n        ElMessage.error(\"获取文章收藏数据失败\");\r\n    }\r\n    }\r\n\r\n\r\n  onMounted(async () => {\r\n      fetchArticleColumn(currentPage.value);\r\n  });\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.hh{\r\n    display: flex;\r\n    flex-direction: column;\r\n    height: 81vh;\r\n    width: 100%;\r\n    overflow-y: auto;\r\n    overflow-x: hidden;\r\n}\r\n.cbutton{\r\n    border-bottom: 1px solid rgb(212, 212, 212);\r\n    padding: 9px 1%;\r\n    width: 98%;\r\n}\r\n.tatitle{\r\n    color: #000; \r\n    text-align: center;\r\n    font-family: Microsoft YaHei;\r\n    font-size: 23px;\r\n    line-height: 1.6; \r\n}\r\n.show{\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: 30px 30px;\r\n    gap: 16px;\r\n    border-radius: 4px;\r\n    background-color: #fffffc;\r\n    border-bottom: 1px solid rgb(240 240 240);\r\n}\r\n.title{\r\n    color: #000;\r\n    font-size: 18px;\r\n    font-weight: 700;\r\n    line-height: 120%; \r\n}\r\n.content{\r\n    width: 600px;\r\n    margin: 15px 0px;\r\n    color: #646464;\r\n    line-height: 1.6;\r\n}\r\n.more{\r\n    display: flex;\r\n    gap: 40px;\r\n    margin-top: 15px;\r\n}\r\n.time{\r\n    color: #76849f;;\r\n    font-size: 14px;\r\n    line-height: 120%;\r\n}\r\n.text{\r\n    color: #2B6AE8;\r\n    text-align: center;\r\n    font-size: 14px;\r\n    line-height: 120%; \r\n    cursor: pointer;\r\n}\r\n.carepic{\r\n    width: 170px;\r\n    height: 110px;\r\n    border-radius: 8px;\r\n}\r\n/* 调整滚动条宽度和颜色 */\r\n::-webkit-scrollbar {\r\n    width: 6px; /* 增加纵向滚动条的宽度 */\r\n    height: 8px; /* 增加横向滚动条的高度 */\r\n    background: transparent;\r\n}\r\n\r\n/* 定义滚动条轨道，设置为透明 */\r\n::-webkit-scrollbar-track {\r\n    box-shadow: inset 0 0 8px rgba(0, 0, 0, 0); /* 内阴影 */\r\n    background: transparent; /* 将轨道背景设置为透明 */\r\n}\r\n\r\n/* 定义滑块，设置为浅灰色并增加内阴影 */\r\n::-webkit-scrollbar-thumb {\r\n    box-shadow: inset 0 0 8px rgba(145, 145, 145, 0.3); /* 添加淡灰色内阴影 */\r\n    background-color: #e2e2e2; /* 滑块的颜色改为浅灰色 */\r\n    border-radius: 10px; /* 保持圆角不变 */\r\n}\r\n/* 当鼠标悬停在滚动条滑块上时改变滑块的颜色 */\r\n::-webkit-scrollbar-thumb:hover {\r\n    background: #c8c8c8;\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}