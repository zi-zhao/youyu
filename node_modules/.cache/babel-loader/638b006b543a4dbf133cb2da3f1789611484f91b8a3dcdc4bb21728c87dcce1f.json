{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeStyle as _normalizeStyle, createTextVNode as _createTextVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-0ec76400\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"container\"\n};\nconst _hoisted_2 = {\n  class: \"coverage\"\n};\nconst _hoisted_3 = {\n  class: \"beforepic\"\n};\nconst _hoisted_4 = [\"src\"];\nconst _hoisted_5 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", null, \"(之前使用的头像)\", -1 /* HOISTED */));\nconst _hoisted_6 = {\n  class: \"afterpic\"\n};\nconst _hoisted_7 = {\n  class: \"picshow\"\n};\nconst _hoisted_8 = {\n  class: \"tpic\"\n};\nconst _hoisted_9 = {\n  class: \"pic_contain\"\n};\nconst _hoisted_10 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", null, \"(您要修改后的头像)\", -1 /* HOISTED */));\nconst _hoisted_11 = {\n  class: \"dialog-footer\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Plus = _resolveComponent(\"Plus\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_CircleCloseFilled = _resolveComponent(\"CircleCloseFilled\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_dialog = _resolveComponent(\"el-dialog\");\n  return _openBlock(), _createElementBlock(\"div\", null, [_createVNode(_component_el_dialog, {\n    modelValue: $setup.localDialogVisible,\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.localDialogVisible = $event),\n    title: '修改头像',\n    style: {\n      \"width\": \"60%\",\n      \"height\": \"60%\"\n    }\n  }, {\n    footer: _withCtx(() => [_createElementVNode(\"span\", _hoisted_11, [_createVNode(_component_el_button, {\n      onClick: _cache[0] || (_cache[0] = $event => $setup.localDialogVisible = false)\n    }, {\n      default: _withCtx(() => [_createTextVNode(\"Cancel\")]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_button, {\n      type: \"primary\",\n      onClick: $setup.setUserAvater\n    }, {\n      default: _withCtx(() => [_createTextVNode(\" 提交 \")]),\n      _: 1 /* STABLE */\n    })])]),\n    default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_1, [_createCommentVNode(\" 更换头像 \"), _createElementVNode(\"div\", _hoisted_2, [_createCommentVNode(\" <span class=\\\"pictext\\\">封面</span> \"), _createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"img\", {\n      src: $setup.userAvatar,\n      alt: \"\",\n      style: {\n        \"width\": \"180px\",\n        \"height\": \"180px\",\n        \"border-radius\": \"10px\"\n      }\n    }, null, 8 /* PROPS */, _hoisted_4), _hoisted_5]), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"input\", {\n      type: \"file\",\n      ref: \"fileInput\",\n      accept: \"image/*\",\n      style: {\n        \"display\": \"none\"\n      },\n      onChange: $setup.handleImage\n    }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), _createElementVNode(\"div\", _hoisted_8, [_createVNode(_component_el_icon, {\n      onClick: $setup.triggerImageUpload,\n      style: {\n        \"position\": \"absolute\",\n        \"left\": \"70px\",\n        \"top\": \"70px\",\n        \"font-size\": \"40px\",\n        \"cursor\": \"pointer\"\n      }\n    }, {\n      default: _withCtx(() => [_createVNode(_component_Plus)]),\n      _: 1 /* STABLE */\n    })]), _createElementVNode(\"div\", _hoisted_9, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.imagePreviews, (imagePreview, index) => {\n      return _openBlock(), _createElementBlock(\"div\", {\n        key: index,\n        class: \"spic\",\n        style: _normalizeStyle({\n          backgroundImage: `url(${imagePreview})`\n        })\n      }, [_createVNode(_component_el_icon, {\n        class: \"delete-btn\",\n        onClick: $event => $setup.removeImage(index)\n      }, {\n        default: _withCtx(() => [_createVNode(_component_CircleCloseFilled)]),\n        _: 2 /* DYNAMIC */\n      }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])], 4 /* STYLE */);\n    }), 128 /* KEYED_FRAGMENT */))])]), _hoisted_10])])])]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\"])]);\n}","map":{"version":3,"names":["class","_createElementVNode","_createElementBlock","_createVNode","_component_el_dialog","$setup","localDialogVisible","$event","title","style","footer","_withCtx","_hoisted_11","_component_el_button","onClick","_cache","type","setUserAvater","_hoisted_1","_createCommentVNode","_hoisted_2","_hoisted_3","src","userAvatar","alt","_hoisted_5","_hoisted_6","_hoisted_7","ref","accept","onChange","handleImage","_hoisted_8","_component_el_icon","triggerImageUpload","_component_Plus","_hoisted_9","_Fragment","_renderList","imagePreviews","imagePreview","index","key","_normalizeStyle","backgroundImage","removeImage","_component_CircleCloseFilled","_hoisted_10"],"sources":["D:\\有渔\\前端源码\\YouyuBBS-Q - 副本\\youyu-lyn-qtnew-vision-new-2024.1.14\\src\\page\\TheSettings\\components\\ChangeAvatar.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <el-dialog v-model=\"localDialogVisible\" :title=\"'修改头像'\" style=\"width: 60%; height: 60%; \">\r\n        <div class=\"container\">\r\n            <!-- 更换头像 -->\r\n            <div class=\"coverage\">\r\n                <!-- <span class=\"pictext\">封面</span> -->\r\n                <div class=\"beforepic\">\r\n                  <img  :src=\"userAvatar\" alt=\"\" style=\"width: 180px; height: 180px; border-radius: 10px;\">\r\n                  <span>(之前使用的头像)</span>\r\n                </div>\r\n                <div class=\"afterpic\">\r\n                  <div class=\"picshow\">\r\n                    <input type=\"file\" ref=\"fileInput\" accept=\"image/*\" style=\"display: none;\" @change=\"handleImage\" />\r\n                    <div  class=\"tpic\" >\r\n                        <el-icon @click=\"triggerImageUpload\" style=\"position: absolute; left: 70px; top: 70px;font-size: 40px;cursor: pointer;\"><Plus /></el-icon>\r\n                    </div>\r\n                    <div class=\"pic_contain\">\r\n                      <div v-for=\"(imagePreview, index) in imagePreviews\" :key=\"index\" class=\"spic\" :style=\"{ backgroundImage: `url(${imagePreview})` }\">\r\n                        <el-icon class=\"delete-btn\" @click=\"removeImage(index)\"><CircleCloseFilled /></el-icon>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <span>(您要修改后的头像)</span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <template #footer>\r\n        <span class=\"dialog-footer\">\r\n            <el-button @click=\"localDialogVisible = false\">Cancel</el-button>\r\n            <el-button type=\"primary\" @click =\"setUserAvater\">\r\n            提交\r\n            </el-button>\r\n        </span>\r\n        </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ElMessage } from 'element-plus';\r\nimport {ref,defineProps,onMounted,watchEffect,defineEmits} from \"vue\";\r\nimport { getUsersAvatarPermission,getUsersAvatarFromCOS } from '@/utils/cosService';\r\nimport {compressImage} from '@/utils/fileService';\r\n\r\nconst props = defineProps({\r\n    modelValue: Boolean,\r\n});\r\n\r\nconst emit = defineEmits(['update:modelValue']);\r\nconst localDialogVisible = ref(props.modelValue);\r\nwatchEffect(() => {\r\n  if (localDialogVisible.value !== props.modelValue) {\r\n    emit('update:modelValue', localDialogVisible.value);\r\n  }\r\n});\r\n\r\nconst userId = ref('');\r\nconst userAvatar = ref('')//获取用户之前的头像\r\n\r\nconst fileInput = ref(null);\r\nconst fileName = ref();\r\nconst selectedImages = ref([]);\r\nconst imagePreviews = ref([]);\r\n// const CHUNK_SIZE = 5 * 1024 * 1024;\r\n\r\n\r\n\r\n// 当点击按钮时触发文件输入框\r\nconst triggerImageUpload = () => {\r\n  if (selectedImages.value.length < 2) {\r\n    fileInput.value.click();\r\n  } else {\r\n    ElMessage.error('只能提交一张照片');\r\n  }\r\n};\r\n\r\n// 当文件选择后处理图片\r\nconst handleImage = async (event) => {\r\n  const file = event.target.files[0];\r\n  if (file && selectedImages.value.length < 2) {\r\n    const timestamp = new Date().getTime(); // 获取当前时间戳\r\n    fileName.value = `${timestamp}-${file.name}`; // 在文件名前加时间戳\r\n    const compressedFile = await compressImage(file);\r\n    const reader = new FileReader();\r\n    reader.onload = function(e) {\r\n      imagePreviews.value.push(e.target.result);\r\n      selectedImages.value.push(compressedFile);\r\n    };\r\n    reader.onerror = function(e) {\r\n      console.error(\"Error reading file:\", e); // 错误处理\r\n    };\r\n    reader.readAsDataURL(compressedFile);\r\n  } else {\r\n    console.log(\"文件数量超标\"); \r\n  }\r\n};\r\n\r\n\r\n//删除图片\r\nconst removeImage = (index) => {\r\n    selectedImages.value.splice(index, 1);\r\n    imagePreviews.value.splice(index, 1);  // 也删除对应的预览\r\n};\r\n\r\n//修改用户头像\r\nasync function setUserAvater() {\r\n  try {\r\n    await getUsersAvatarPermission(selectedImages.value[0],fileName.value);\r\n    setTimeout(() => {\r\n      localDialogVisible.value= false;\r\n    }, 1000);\r\n    ElMessage.success('修改个人头像成功');\r\n  } catch (error) {\r\n      console.error(\"修改个人头像失败\", error); \r\n      ElMessage.error('修改个人头像失败');\r\n  }\r\n}\r\n\r\n// 获取用户头像\r\nconst fetchAvatar = async () => {\r\n  try {\r\n    userAvatar.value = await getUsersAvatarFromCOS(userId.value);\r\n  } catch (error) {\r\n    console.error(\"Error fetching user avatar:\", error);\r\n    ElMessage.error('获取用户头像失败');\r\n  }\r\n};\r\n\r\nonMounted(() => {\r\n  userId.value = localStorage.getItem(\"userId\"); // 获取用户ID\r\n  fetchAvatar();\r\n});\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.container{\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 30px;\r\n}\r\n.coverage{\r\n    display: flex;\r\n    justify-content: space-evenly;\r\n    gap: 20px;\r\n    width: 100%;\r\n    height: 180px;\r\n}\r\n.beforepic,\r\n.afterpic {\r\n    display: flex;\r\n    gap: 10px;\r\n    align-items: flex-end;\r\n}\r\n.picshow {\r\n    width: 180px;\r\n    height: 180px;\r\n    border: 1px dashed #bbbbbb;\r\n    border-radius: 10px;\r\n    cursor: pointer;\r\n    position: relative;\r\n}\r\n.spic{\r\n    background-size: cover;\r\n    background-repeat: no-repeat;\r\n    background-position: center center;\r\n    width: 180px;\r\n    height: 180px;\r\n}\r\n.pic_contain{\r\n  position: relative;\r\n}\r\ni.delete-btn {\r\n  position: absolute;\r\n  right: 5px;\r\n  top: 8px;\r\n  cursor: pointer;\r\n}\r\n/* .avatar-uploader{\r\n    width: 90%;\r\n    border-radius: 10px\r\n}\r\n.avatar-uploader .avatar {\r\n  width: 150px;\r\n  height: 150px;\r\n  display: block;\r\n}\r\n.avatar-uploader .el-upload {\r\n  border: 1px dashed var(--el-border-color);\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\r\n  transition: var(--el-transition-duration-fast);\r\n}\r\n\r\n.avatar-uploader .el-upload:hover {\r\n  border-color: var(--el-color-primary);\r\n}\r\n.el-upload-list--picture-card{\r\n  --el-upload-list-picture-card-size: 150px;\r\n}\r\n.el-icon.avatar-uploader-icon {\r\n  font-size: 28px;\r\n  color: #8c939d;\r\n  width: 150px;\r\n  height: 150px;\r\n  text-align: center;\r\n} */\r\n\r\n::v-deep .el-dialog__body {\r\n  padding: 0px var(--el-dialog-padding-primary);\r\n}\r\n::v-deep .el-dialog__header{\r\n  padding-bottom: 20px;\r\n}\r\n::v-deep .el-dialog__footer {\r\n  padding: 0px;\r\n  position: absolute;\r\n  right: 15px;\r\n  bottom: 10px;\r\n}\r\n::v-deep .el-input ,\r\n::v-deep .el-textarea{\r\n  width: 90%;\r\n}\r\n/* 三个输入框边框样式 */\r\n::v-deep .el-input__wrapper,\r\n::v-deep .el-textarea__inner{\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n}\r\n::v-deep .el-input__wrapper{\r\n  height: 40px;\r\n}  \r\n::v-deep .el-textarea__inner{\r\n  height: 130px;\r\n}  \r\n/* 三个输入框获得焦点时的边框样式 */\r\n::v-deep .el-input__wrapper.is-focus,\r\n::v-deep .el-textarea__inner:focus{\r\n  box-shadow: 0 2px 6px #cfd7e2;\r\n  border: 1px solid #d7d7d7;\r\n}\r\n.input_el textarea {\r\n  overflow: hidden;\r\n}\r\n.dialog-footer button:first-child {\r\n  margin-right: 10px;\r\n}\r\n\r\n</style>"],"mappings":";;;EAGaA,KAAK,EAAC;AAAW;;EAEbA,KAAK,EAAC;AAAU;;EAEZA,KAAK,EAAC;AAAW;;gEAEpBC,mBAAA,CAAsB,cAAhB,WAAS;;EAEZD,KAAK,EAAC;AAAU;;EACdA,KAAK,EAAC;AAAS;;EAEZA,KAAK,EAAC;AAAM;;EAGbA,KAAK,EAAC;AAAa;iEAM1BC,mBAAA,CAAuB,cAAjB,YAAU;;EAKpBD,KAAK,EAAC;AAAe;;;;;;;uBA3BjCE,mBAAA,CAmCM,cAlCJC,YAAA,CAiCYC,oBAAA;gBAjCQC,MAAA,CAAAC,kBAAkB;+DAAlBD,MAAA,CAAAC,kBAAkB,GAAAC,MAAA;IAAGC,KAAK,EAAE,MAAM;IAAEC,KAAiC,EAAjC;MAAA;MAAA;IAAA;;IAyBzCC,MAAM,EAAAC,QAAA,CACjB,MAKO,CALPV,mBAAA,CAKO,QALPW,WAKO,GAJHT,YAAA,CAAiEU,oBAAA;MAArDC,OAAK,EAAAC,MAAA,QAAAA,MAAA,MAAAR,MAAA,IAAEF,MAAA,CAAAC,kBAAkB;;wBAAU,MAAM,C,iBAAN,QAAM,E;;QACrDH,YAAA,CAEYU,oBAAA;MAFDG,IAAI,EAAC,SAAS;MAAEF,OAAK,EAAGT,MAAA,CAAAY;;wBAAe,MAElD,C,iBAFkD,MAElD,E;;;sBA7BJ,MAuBM,CAvBNhB,mBAAA,CAuBM,OAvBNiB,UAuBM,GAtBFC,mBAAA,UAAa,EACblB,mBAAA,CAoBM,OApBNmB,UAoBM,GAnBFD,mBAAA,uCAAwC,EACxClB,mBAAA,CAGM,OAHNoB,UAGM,GAFJpB,mBAAA,CAAyF;MAAlFqB,GAAG,EAAEjB,MAAA,CAAAkB,UAAU;MAAEC,GAAG,EAAC,EAAE;MAACf,KAAyD,EAAzD;QAAA;QAAA;QAAA;MAAA;yCAC/BgB,UAAsB,C,GAExBxB,mBAAA,CAaM,OAbNyB,UAaM,GAZJzB,mBAAA,CAUM,OAVN0B,UAUM,GATJ1B,mBAAA,CAAmG;MAA5Fe,IAAI,EAAC,MAAM;MAACY,GAAG,EAAC,WAAW;MAACC,MAAM,EAAC,SAAS;MAACpB,KAAsB,EAAtB;QAAA;MAAA,CAAsB;MAAEqB,QAAM,EAAEzB,MAAA,CAAA0B;oDACpF9B,mBAAA,CAEM,OAFN+B,UAEM,GADF7B,YAAA,CAA0I8B,kBAAA;MAAhInB,OAAK,EAAET,MAAA,CAAA6B,kBAAkB;MAAEzB,KAAkF,EAAlF;QAAA;QAAA;QAAA;QAAA;QAAA;MAAA;;wBAAmF,MAAQ,CAARN,YAAA,CAAQgC,eAAA,E;;UAEpIlC,mBAAA,CAIM,OAJNmC,UAIM,I,kBAHJlC,mBAAA,CAEMmC,SAAA,QAAAC,WAAA,CAF+BjC,MAAA,CAAAkC,aAAa,GAArCC,YAAY,EAAEC,KAAK;2BAAhCvC,mBAAA,CAEM;QAF+CwC,GAAG,EAAED,KAAK;QAAEzC,KAAK,EAAC,MAAM;QAAES,KAAK,EAAAkC,eAAA;UAAAC,eAAA,SAA4BJ,YAAY;QAAA;UAC1HrC,YAAA,CAAuF8B,kBAAA;QAA9EjC,KAAK,EAAC,YAAY;QAAEc,OAAK,EAAAP,MAAA,IAAEF,MAAA,CAAAwC,WAAW,CAACJ,KAAK;;0BAAG,MAAqB,CAArBtC,YAAA,CAAqB2C,4BAAA,E;;;wCAInFC,WAAuB,C"},"metadata":{},"sourceType":"module","externalDependencies":[]}