{"ast":null,"code":"import { createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createBlock as _createBlock, createCommentVNode as _createCommentVNode, resolveDirective as _resolveDirective, withDirectives as _withDirectives, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-644b276c\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"alove\"\n};\nconst _hoisted_2 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"cbutton\"\n}, [/*#__PURE__*/_createElementVNode(\"span\", {\n  class: \"tatitle\"\n}, \"TA的粉丝\"), /*#__PURE__*/_createElementVNode(\"span\", {\n  class: \"line2\"\n})], -1 /* HOISTED */));\nconst _hoisted_3 = {\n  key: 0,\n  class: \"container\",\n  \"infinite-scroll-distance\": \"100\",\n  \"infinite-scroll-immediate\": \"false\"\n};\nconst _hoisted_4 = {\n  class: \"asset\"\n};\nconst _hoisted_5 = [\"src\"];\nconst _hoisted_6 = {\n  class: \"show\"\n};\nconst _hoisted_7 = {\n  class: \"user\"\n};\nconst _hoisted_8 = {\n  class: \"uname\"\n};\nconst _hoisted_9 = {\n  class: \"achieve\"\n};\nconst _hoisted_10 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", {\n  class: \"intro\"\n}, \"个人成就：\", -1 /* HOISTED */));\nconst _hoisted_11 = {\n  class: \"intro\"\n};\nconst _hoisted_12 = {\n  class: \"achieve\"\n};\nconst _hoisted_13 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", {\n  class: \"intro\"\n}, \"个人简介：\", -1 /* HOISTED */));\nconst _hoisted_14 = {\n  class: \"intro\"\n};\nconst _hoisted_15 = {\n  class: \"carebutton\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_empty = _resolveComponent(\"el-empty\");\n  const _directive_infinite_scroll = _resolveDirective(\"infinite-scroll\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_hoisted_2, $setup.userlist || $setup.userlist.length !== 0 ? _withDirectives((_openBlock(), _createElementBlock(\"div\", _hoisted_3, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.userlist, (user, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: \"care_box\"\n    }, [_createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"img\", {\n      src: user.newAvatar,\n      class: \"upic\"\n    }, null, 8 /* PROPS */, _hoisted_5), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"span\", _hoisted_8, _toDisplayString(user.fanUsername), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_9, [_hoisted_10, _createElementVNode(\"span\", _hoisted_11, _toDisplayString(user.achievement), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_12, [_hoisted_13, _createElementVNode(\"span\", _hoisted_14, _toDisplayString(user.description), 1 /* TEXT */)])]), _createElementVNode(\"div\", _hoisted_15, [user.focusStatus ? (_openBlock(), _createBlock(_component_el_button, {\n      key: 0,\n      type: \"primary\",\n      round: \"\",\n      onClick: $event => $setup.followUser(user),\n      class: \"focus\"\n    }, {\n      default: _withCtx(() => [_createTextVNode(\"已关注\")]),\n      _: 2 /* DYNAMIC */\n    }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])) : (_openBlock(), _createBlock(_component_el_button, {\n      key: 1,\n      type: \"primary\",\n      round: \"\",\n      onClick: $event => $setup.followUser(user),\n      class: \"gofocus\"\n    }, {\n      default: _withCtx(() => [_createTextVNode(\"+关注\")]),\n      _: 2 /* DYNAMIC */\n    }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"]))])])]);\n  }), 128 /* KEYED_FRAGMENT */))])), [[_directive_infinite_scroll, $setup.load]]) : (_openBlock(), _createBlock(_component_el_empty, {\n    key: 1,\n    \"image-size\": 200,\n    description: \"他还没有粉丝呢！\"\n  }))]);\n}","map":{"version":3,"names":["class","_createElementVNode","_createElementBlock","_hoisted_1","_hoisted_2","$setup","userlist","length","_hoisted_3","_Fragment","_renderList","user","index","key","_hoisted_4","src","newAvatar","_hoisted_6","_hoisted_7","_hoisted_8","_toDisplayString","fanUsername","_hoisted_9","_hoisted_10","_hoisted_11","achievement","_hoisted_12","_hoisted_13","_hoisted_14","description","_hoisted_15","focusStatus","_createBlock","_component_el_button","type","round","onClick","$event","followUser","load","_component_el_empty"],"sources":["D:\\有渔\\前端源码\\YouyuBBS-Q - 副本\\youyu-lyn-qtnew-vision-new-2024.1.14\\src\\page\\OtherUserPersonalpage\\last\\AllLover.vue"],"sourcesContent":["<template>\r\n    <div class=\"alove\">\r\n      <div class=\"cbutton\">\r\n        <span class=\"tatitle\">TA的粉丝</span>\r\n        <span class=\"line2\"></span>\r\n      </div>\r\n      <div v-if=\"userlist || userlist.length !== 0\" class=\"container\" v-infinite-scroll=\"load\" infinite-scroll-distance=\"100\" infinite-scroll-immediate=\"false\">\r\n        <div v-for=\"(user, index) in userlist\" :key=\"index\" class=\"care_box\">\r\n          <div class=\"asset\">\r\n            <img :src=\"user.newAvatar\" class=\"upic\">\r\n            <div class=\"show\">\r\n              <div class=\"user\">\r\n                <span class=\"uname\">{{ user.fanUsername }}</span>\r\n              </div>\r\n              <div class=\"achieve\">\r\n                <span class=\"intro\">个人成就：</span>\r\n                <span class=\"intro\">{{ user.achievement }}</span>\r\n              </div>\r\n              <div class=\"achieve\">\r\n                <span class=\"intro\">个人简介：</span>\r\n                <span class=\"intro\">{{ user.description }}</span>\r\n              </div>\r\n            </div>\r\n            <div class=\"carebutton\">\r\n              <el-button v-if=\"user.focusStatus\" type=\"primary\" round @click=\"followUser(user)\" class=\"focus\">已关注</el-button>\r\n              <el-button v-else type=\"primary\" round  @click=\"followUser(user)\" class=\"gofocus\">+关注</el-button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <el-empty \r\n          v-else\r\n          :image-size=\"200\" \r\n          description=\"他还没有粉丝呢！\"\r\n      />\r\n    </div>\r\n  </template>\r\n  \r\n  <script setup>\r\n  import { ref, onMounted } from \"vue\";\r\n  import axios from '@/utils/request';\r\n  import { ElMessage } from 'element-plus';\r\n  import { getUsersAvatarFromCOS } from '@/utils/cosService';\r\n  import { convertDateFormat } from '@/utils/timeFormat';\r\n\r\n  \r\n  const currentPage = ref(1);\r\n  const userlist = ref([]);\r\n  \r\n  //获取用户id\r\n  const getPathParams = () => {\r\n    const currentURL = window.location.href;\r\n    const match = currentURL.match(/\\/OtherUserPersonalPage\\/helover\\/(\\d+)/);\r\n    if (match) {\r\n        const pageNumber = match[1];\r\n        return pageNumber;\r\n    } else {\r\n        console.log('页面地址中没有找到数字部分。');\r\n    }\r\n  }\r\n  const userId = getPathParams();\r\n\r\n  // 添加一个锁状态\r\n  let isLoading = false;\r\n  async function load() {\r\n    if (isLoading) return; // 如果已经在加载中，则直接返回不执行新的加载\r\n    isLoading = true; // 开始加载数据，设置锁状态为true\r\n    try {\r\n        if(currentPage.value === 1){\r\n            currentPage.value++;\r\n        }\r\n        await getMyFocusNote(currentPage.value);\r\n        currentPage.value++; // 只有在请求成功完成后才递增页码\r\n    } catch (error) {\r\n        console.error(error);\r\n        ElMessage.error('滚动时的未知错误');\r\n    } finally {\r\n        isLoading = false; // 请求完成，无论成功或失败，都释放锁状态\r\n    }\r\n  }\r\n\r\n  async function getMyFocusNote(currentPage) {\r\n    try {\r\n      // const response = await axios.get('/users/fans?apifoxApiId=105505347');\r\n      const response = await axios.get('/users/fans', {\r\n        params: {\r\n          id:userId,\r\n          page:currentPage,\r\n          pazeSize:10\r\n        }\r\n      });\r\n      if(response.data.data.records){\r\n        const updates = response.data.data.records;\r\n        for (let record of updates) {\r\n          record.createTime = convertDateFormat(record.createTime);\r\n          record.newAvatar = await getUsersAvatarFromCOS(record.fanId);\r\n          record.focusStatus  = deterFocus(record)\r\n        }\r\n        userlist.value = [...userlist.value, ...updates];\r\n      }else if (response.data.code === 1 && response.data.data.records.length === 0) {\r\n          // ElMessage.info('已加载所有数据');\r\n      }else if(response.data.code === 0 && response.data.msg){\r\n          ElMessage.error(response.data.msg.toString());\r\n      }else{\r\n          console.error(\"获取用户粉丝数据失败\");\r\n          ElMessage.error(\"获取用户粉丝数据失败\");\r\n      }\r\n      } catch (error) {\r\n        console.log(error);\r\n        ElMessage.error('获取用户粉丝数据失败');\r\n      }\r\n    }\r\n\r\n  //判断关注状态\r\n  async function deterFocus(record) {\r\n    try {\r\n      const response = await axios.get(`/users/subscribe/state/${record.starId}`)\r\n      if (response.data.code === 1 && response.data.data.records.length > 0) {\r\n        record.focusStatus.value = response.data.data;\r\n        console.log('获取关注状态成功');\r\n        console.log(record.focusStatus.value);\r\n      } else if(response.data.code === 0 && response.data.msg){\r\n          ElMessage.error(response.data.msg.toString());\r\n      }else {\r\n        console.error(response.data.msg || 'Unknown error');\r\n        ElMessage.error('获取关注状态失败');\r\n      }\r\n    } catch (error) {\r\n      console.error('获取关注状态失败', error.message);\r\n      ElMessage.error('获取关注状态失败');\r\n    }\r\n  }\r\n\r\n    //关注用户接口\r\n    async function followUser(user) {\r\n    try {\r\n      const response = await axios.put(`users/subscribe/${user.starId}`);\r\n      user.focusStatus.value = user.focusStatus.value === 0 ? 1 : 0;\r\n      if (response.data && response.data.code === 1) {\r\n        console.log('用户已关注/用户已取消关注');\r\n      } else if(response.data.code === 0 && response.data.msg){\r\n          ElMessage.error(response.data.msg.toString());\r\n      }else {\r\n        console.error(response.data.msg || 'Unknown error');\r\n        ElMessage.error('关注/取消关注 失败了哦');\r\n      }\r\n    } catch (error) {\r\n      console.error('关注/取消关注 失败了哦', error.message);\r\n      ElMessage.error('关注/取消关注 失败了哦');\r\n    }\r\n  }\r\n\r\n  onMounted(() => {\r\n    getMyFocusNote(currentPage.value)\r\n  })\r\n\r\n\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.alove{\r\n  width: 100%;\r\n}\r\n.cbutton{\r\n  position: relative;\r\n  width: 98%;\r\n  padding: 1%;\r\n  right: 0px;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n.tatitle{\r\n  color: #000; \r\n  text-align: center;\r\n  line-height: 1.6;\r\n  font-size: 23px;\r\n}\r\n.line2 {\r\n  position: absolute;\r\n  bottom: 0px;\r\n  left: 0px;\r\n  width: 100%;\r\n  height: 1px;\r\n  background: rgb(212, 212, 212);\r\n}\r\n.asset{\r\n  margin: 8px 30px;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n.container{\r\n  position: relative;\r\n  height: 80vh;\r\n  overflow-y: auto;\r\n  overflow-x: hidden;\r\n}\r\n.care_box{\r\n  margin: 10px 0px;\r\n  padding: 5px 30px;\r\n}\r\n.upic{\r\n  width: 60px;\r\n  height: 60px;\r\n  flex-shrink: 0;\r\n  border-radius: 60px;\r\n}\r\n.show{\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 5px;\r\n  width: 78%;\r\n  margin-top: 10px;\r\n}\r\n.uname{\r\n  color: #000;\r\n  text-align: center;\r\n  font-family: Microsoft YaHei;\r\n  font-size: 16px;\r\n  font-weight: 700;\r\n  line-height: 1.6; \r\n}\r\n.intro{\r\n  color: #000;\r\n  text-align: center;\r\n  font-size: 14px;\r\n  line-height: 1.6; \r\n}\r\n.user{\r\n  display: flex;\r\n  align-items: flex-end;\r\n  gap: 4px;\r\n}\r\n.achieve{\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n}\r\n.carebutton .el-button{\r\n  padding: 5px 15px;\r\n  border: none;\r\n  border: 1px solid #D9DCE1;\r\n}\r\n.focus{\r\n  background-color: #E5E9EF;\r\n  color: #6D758B;\r\n}\r\n.gofocus{\r\n  background-color: #fff;\r\n  color: #6D758B;\r\n}\r\n/* 调整滚动条宽度和颜色 */\r\n::-webkit-scrollbar {\r\n    width: 6px; /* 增加纵向滚动条的宽度 */\r\n    height: 8px; /* 增加横向滚动条的高度 */\r\n    background: transparent;\r\n}\r\n\r\n/* 定义滚动条轨道，设置为透明 */\r\n::-webkit-scrollbar-track {\r\n    box-shadow: inset 0 0 8px rgba(0, 0, 0, 0); /* 内阴影 */\r\n    background: transparent; /* 将轨道背景设置为透明 */\r\n}\r\n\r\n/* 定义滑块，设置为浅灰色并增加内阴影 */\r\n::-webkit-scrollbar-thumb {\r\n    box-shadow: inset 0 0 8px rgba(145, 145, 145, 0.3); /* 添加淡灰色内阴影 */\r\n    background-color: #e2e2e2; /* 滑块的颜色改为浅灰色 */\r\n    border-radius: 10px; /* 保持圆角不变 */\r\n}\r\n/* 当鼠标悬停在滚动条滑块上时改变滑块的颜色 */\r\n::-webkit-scrollbar-thumb:hover {\r\n    background: #c8c8c8;\r\n}\r\n</style>"],"mappings":";;;EACSA,KAAK,EAAC;AAAO;gEAChBC,mBAAA,CAGM;EAHDD,KAAK,EAAC;AAAS,I,aAClBC,mBAAA,CAAkC;EAA5BD,KAAK,EAAC;AAAS,GAAC,OAAK,G,aAC3BC,mBAAA,CAA2B;EAArBD,KAAK,EAAC;AAAO,G;;;EAEyBA,KAAK,EAAC,WAAW;EAA0B,0BAAwB,EAAC,KAAK;EAAC,2BAAyB,EAAC;;;EAEzIA,KAAK,EAAC;AAAO;;;EAEXA,KAAK,EAAC;AAAM;;EACVA,KAAK,EAAC;AAAM;;EACTA,KAAK,EAAC;AAAO;;EAEhBA,KAAK,EAAC;AAAS;iEAClBC,mBAAA,CAAgC;EAA1BD,KAAK,EAAC;AAAO,GAAC,OAAK;;EACnBA,KAAK,EAAC;AAAO;;EAEhBA,KAAK,EAAC;AAAS;iEAClBC,mBAAA,CAAgC;EAA1BD,KAAK,EAAC;AAAO,GAAC,OAAK;;EACnBA,KAAK,EAAC;AAAO;;EAGlBA,KAAK,EAAC;AAAY;;;;;uBAtB/BE,mBAAA,CAkCM,OAlCNC,UAkCM,GAjCJC,UAGM,EACKC,MAAA,CAAAC,QAAQ,IAAID,MAAA,CAAAC,QAAQ,CAACC,MAAM,S,+BAAtCL,mBAAA,CAuBM,OAvBNM,UAuBM,I,kBAtBJN,mBAAA,CAqBMO,SAAA,QAAAC,WAAA,CArBuBL,MAAA,CAAAC,QAAQ,GAAxBK,IAAI,EAAEC,KAAK;yBAAxBV,mBAAA,CAqBM;MArBkCW,GAAG,EAAED,KAAK;MAAEZ,KAAK,EAAC;QACxDC,mBAAA,CAmBM,OAnBNa,UAmBM,GAlBJb,mBAAA,CAAwC;MAAlCc,GAAG,EAAEJ,IAAI,CAACK,SAAS;MAAEhB,KAAK,EAAC;yCACjCC,mBAAA,CAYM,OAZNgB,UAYM,GAXJhB,mBAAA,CAEM,OAFNiB,UAEM,GADJjB,mBAAA,CAAiD,QAAjDkB,UAAiD,EAAAC,gBAAA,CAA1BT,IAAI,CAACU,WAAW,iB,GAEzCpB,mBAAA,CAGM,OAHNqB,UAGM,GAFJC,WAAgC,EAChCtB,mBAAA,CAAiD,QAAjDuB,WAAiD,EAAAJ,gBAAA,CAA1BT,IAAI,CAACc,WAAW,iB,GAEzCxB,mBAAA,CAGM,OAHNyB,WAGM,GAFJC,WAAgC,EAChC1B,mBAAA,CAAiD,QAAjD2B,WAAiD,EAAAR,gBAAA,CAA1BT,IAAI,CAACkB,WAAW,iB,KAG3C5B,mBAAA,CAGM,OAHN6B,WAGM,GAFanB,IAAI,CAACoB,WAAW,I,cAAjCC,YAAA,CAA+GC,oBAAA;;MAA5EC,IAAI,EAAC,SAAS;MAACC,KAAK,EAAL,EAAK;MAAEC,OAAK,EAAAC,MAAA,IAAEhC,MAAA,CAAAiC,UAAU,CAAC3B,IAAI;MAAGX,KAAK,EAAC;;wBAAQ,MAAG,C,iBAAH,KAAG,E;;uEACnGgC,YAAA,CAAiGC,oBAAA;;MAA/EC,IAAI,EAAC,SAAS;MAACC,KAAK,EAAL,EAAK;MAAGC,OAAK,EAAAC,MAAA,IAAEhC,MAAA,CAAAiC,UAAU,CAAC3B,IAAI;MAAGX,KAAK,EAAC;;wBAAU,MAAG,C,iBAAH,KAAG,E;;;mEAnBVK,MAAA,CAAAkC,IAAI,E,mBAwBvFP,YAAA,CAIEQ,mBAAA;;IAFG,YAAU,EAAE,GAAG;IAChBX,WAAW,EAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}