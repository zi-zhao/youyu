{"ast":null,"code":"import { vModelText as _vModelText, createElementVNode as _createElementVNode, withDirectives as _withDirectives, resolveComponent as _resolveComponent, createVNode as _createVNode, createCommentVNode as _createCommentVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-20c88139\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"body_bgc\"\n};\nconst _hoisted_2 = {\n  style: {\n    \"width\": \"1100px\",\n    \"margin\": \"auto\",\n    \"border-radius\": \"4px\",\n    \"box-shadow\": \"0px 2px 4px 0px rgba(0, 0, 0, 0.25)\"\n  }\n};\nconst _hoisted_3 = {\n  class: \"header\"\n};\nconst _hoisted_4 = {\n  class: \"md-contain\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_v_md_editor = _resolveComponent(\"v-md-editor\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_withDirectives(_createElementVNode(\"input\", {\n    type: \"text\",\n    placeholder: \"请输入文章标题\",\n    class: \"title\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.title = $event)\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.title]])]), _createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_v_md_editor, {\n    modelValue: $setup.text,\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.text = $event),\n    height: \"540px\",\n    class: \"md\",\n    \"left-toolbar\": \"undo redo clear | h bold italic strikethrough quote | ul ol table hr | link image code | save tip emoji | customToolbar \",\n    \"disabled-menus\": [],\n    onUploadImage: $setup.handleUploadImage\n  }, null, 8 /* PROPS */, [\"modelValue\"])])]), _createVNode($setup[\"PictureAndAttachment\"], {\n    Submit: $setup.submitState\n  }, null, 8 /* PROPS */, [\"Submit\"]), _createVNode($setup[\"ToSubmit\"]), _createCommentVNode(\" 底部滚动条 \"), _createElementVNode(\"div\", {\n    class: \"foot\"\n  }, [_createElementVNode(\"div\", {\n    class: \"b-container\"\n  }, [_createElementVNode(\"button\", {\n    class: \"b-1\",\n    onClick: $setup.saveArticleDraft\n  }, \"保存草稿\"), _createCommentVNode(\" <button class=\\\"b-1\\\">定时发布</button> \"), _createElementVNode(\"button\", {\n    class: \"b-2\",\n    onClick: $setup.postArticlePost\n  }, \"发表文章\")])])]);\n}","map":{"version":3,"names":["class","style","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","type","placeholder","$setup","title","$event","_hoisted_4","_createVNode","_component_v_md_editor","text","height","onUploadImage","handleUploadImage","Submit","submitState","_createCommentVNode","onClick","saveArticleDraft","postArticlePost"],"sources":["D:\\有渔\\前端源码\\YouyuBBS-Q - 副本\\youyu-lyn-qtnew-vision-new-2024.1.14\\src\\page\\CreateCenter\\components\\WorkManagement\\TheEditor\\MarkDown.vue"],"sourcesContent":["<template>\r\n  <div class=\"body_bgc\">\r\n    <div style=\"width: 1100px;  margin:auto; border-radius: 4px; box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.25);\">\r\n      <div class=\"header\">\r\n        <input type=\"text\" placeholder=\"请输入文章标题\" class=\"title\" v-model=\"title\">\r\n      </div>\r\n      <div class=\"md-contain\">\r\n        <v-md-editor \r\n          v-model=\"text\" height=\"540px\" class=\"md\" \r\n          left-toolbar=\"undo redo clear | h bold italic strikethrough quote | ul ol table hr | link image code | save tip emoji | customToolbar \"\r\n          :disabled-menus=\"[]\"\r\n          @upload-image=\"handleUploadImage\"\r\n          />\r\n      </div>\r\n    </div>\r\n    <PictureAndAttachment :Submit = \"submitState\"></PictureAndAttachment>\r\n    <ToSubmit />\r\n    <!-- 底部滚动条 -->\r\n    <div class=\"foot\">\r\n      <div class=\"b-container\">\r\n        <button class=\"b-1\" @click=\"saveArticleDraft\">保存草稿</button>\r\n        <!-- <button class=\"b-1\">定时发布</button> -->\r\n        <button class=\"b-2\" @click=\"postArticlePost\">发表文章</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n  \r\n<script setup>\r\nimport { ref,toRaw,onMounted} from 'vue';\r\nimport ToSubmit from './components/ToSubmit.vue';\r\nimport { useStore } from 'vuex';\r\nimport axios from '@/utils/request';\r\nimport { useRoute,useRouter} from 'vue-router';\r\nimport { ElMessage,ElMessageBox} from 'element-plus';\r\nimport PictureAndAttachment from './PictureAndAttachment.vue'\r\nimport {getArticleContentPermission} from '@/utils/cosService';\r\nimport {compressImage} from '@/utils/fileService';\r\n\r\nconst route = useRoute();\r\nconst router = useRouter();\r\nconst articleId = parseInt(route.params.id,10);//路径中的文章ID\r\nconst article = ref();\r\nconst store = useStore();\r\nconst text = ref('');\r\nconst title = ref('');\r\nconst submitState = ref('1');\r\n\r\nasync function handleUploadImage(event, insertImage, files){\r\n  const articleId = localStorage.getItem(\"articleId\"); // 获取文章ID\r\n  // 如果没有选择文件或选择了多个文件，则直接返回\r\n  if (!files || files.length !== 1) {\r\n    console.error('最多选择一张图片！');\r\n    ElMessage.error('最多选择一张图片！')\r\n    return;\r\n  }\r\n  const timestamp = new Date().getTime(); // 获取当前时间戳\r\n  const filePictureName = `${timestamp}-${files.name}`; // 在文件名前加时间戳\r\n  const compressedFile = await compressImage(files);\r\n  const url = await getArticleContentPermission(compressedFile,articleId,filePictureName);\r\n  insertImage({url:url});\r\n}\r\n\r\nfunction checkProperties(...objects) {\r\n  for (let obj of objects) {\r\n    for (let key in obj) {\r\n      if (obj[key] === null || obj[key] === undefined || obj[key] === '') {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n\r\n  //保存草稿的提示弹框\r\nconst saveArticleDraft = async () => {\r\n  try {\r\n    await ElMessageBox.confirm(\r\n      '确定要将文章保存为草稿吗（网站只会保存文章编辑器中的内容和文章标题，不会保存附件、封面图及其他选项的值）？',\r\n      {\r\n        confirmButtonText: '确认保存',\r\n        cancelButtonText: '取消',\r\n        type: 'warning',\r\n      }\r\n    );\r\n    await saveArticle();\r\n  } catch {\r\n    console.log('关闭弹框')\r\n  }\r\n}\r\n\r\n//发表文章的提示弹框\r\nconst postArticlePost = async () => {\r\n  try {\r\n    await ElMessageBox.confirm(\r\n      '确定要发表文章吗（请确认已经填写了所有文章的相关信息，否则无法通过审核）？',\r\n      {\r\n        confirmButtonText: '确认发表',\r\n        cancelButtonText: '取消',\r\n        type: 'warning',\r\n      }\r\n    );\r\n    await postArticle();\r\n  } catch {\r\n    console.log('关闭弹框')\r\n  }\r\n}\r\n  \r\n//将文章添加到专栏接口\r\nasync function uploadColumn(id) {\r\n  const response2 = await axios.post('/column/article', {\r\n    columnId:store.state.submitColumnId,\r\n    contentId:id,\r\n  });\r\n  if(response2.data.code ===1) ElMessage.success('添加专栏成功');\r\n  else if(response2.data.code === 0 && response2.data.msg){\r\n      ElMessage.error(response2.data.msg.toString());\r\n  }else ElMessage.error('添加专栏失败');\r\n}\r\n\r\n//提交文章的接口\r\nasync function postArticle(){\r\n  const articleId = localStorage.getItem(\"articleId\"); // 获取文章ID\r\n  // 初始数据\r\n  const first = ref({\r\n    id:articleId,\r\n    editorType:1,//markdown\r\n  })\r\n  const articleCon = ref({title:title.value,content:text.value});\r\n  const submitData = toRaw(store.state.submitDate);\r\n  const isValid = checkProperties(submitData, first.value, articleCon);\r\n  if(isValid){\r\n    ElMessage.error('未填写所有信息');\r\n    return;\r\n  }\r\n  const data = {...submitData,...first.value,...articleCon.value}\r\n  try {\r\n    const response = await axios.post('/article', data);//发表文章接口\r\n    if(response.data.code ===1) {\r\n      ElMessage.success('发表文章成功');\r\n      uploadColumn(articleId);\r\n      submitState.value = '2';\r\n    }else if(response.data.code === 0 && response.data.msg){\r\n      ElMessage.error(response.data.msg.toString());\r\n    }\r\n    else ElMessage.error('发表文章失败');\r\n  } catch (error) {\r\n    console.log(error);\r\n    ElMessage.error('发表文章失败');\r\n  }\r\n}\r\n\r\n//保存草稿的接口\r\nasync function saveArticle(){\r\n  const articleCon = ref({title:title.value,content:text.value})\r\n  const articleId = localStorage.getItem(\"articleId\"); // 获取文章ID\r\n  const first = ref({\r\n    id:articleId,\r\n    editorType:0,//富文本编辑器\r\n  })\r\n  const data = {...first.value,...articleCon.value}\r\n  try {\r\n    const response = await axios.put('/article/draft', data);\r\n    if(response.data.code ===1) {\r\n      ElMessage.success('保存草稿成功');\r\n      router.push('/CreateCenter');\r\n    }else if(response.data.code === 0 && response.data.msg){\r\n      ElMessage.error(response.data.msg.toString());\r\n    }\r\n    else ElMessage.error('保存草稿失败');\r\n  } catch (error) {\r\n    console.log(error);\r\n    ElMessage.error('保存草稿失败');\r\n  }\r\n}\r\n\r\n//获取文章内容\r\nasync function fetchArticleContent(id) {\r\n  try {\r\n    const response = await axios.get(`/article/${id}`);\r\n    if ( response.data.code === 1) {\r\n      article.value = response.data.data;\r\n      text.value = article.value.content;\r\n      title.value = article.value.title;\r\n    } else if(response.data.code === 0 && response.data.msg){\r\n      ElMessage.error(response.data.msg.toString());\r\n    }else {\r\n      console.error('无法找到匹配文章数据', response.data.msg || 'Unknown error');\r\n      ElMessage.error('无法找到匹配文章数据');\r\n    }\r\n  } catch (error) {\r\n    console.error('无法获取接口数据', error.message);\r\n    ElMessage.error('无法找到匹配文章数据');\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  await fetchArticleContent(articleId);\r\n});\r\n\r\n</script>\r\n\r\n<style scoped>\r\n::v-deep .el-dialog{\r\n  width: 900px;\r\n  height: 640px;\r\n  border-radius: 4px;\r\n  box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);\r\n}\r\n::v-deep .el-dialog__body{\r\n  padding: 0px;\r\n}\r\n::v-deep .el-dialog__header{\r\n  padding: 0px;\r\n}\r\n::v-deep .large_submit {\r\n  box-shadow: none\r\n}\r\n::v-deep .el-dialog{\r\n  width: 1100px;\r\n}\r\n.body_bgc{\r\n  background-color: #fdfbf6;\r\n}\r\n.header{\r\n  width: 1100px;\r\n  height: 65px;\r\n  display: flex;\r\n  align-items: center;\r\n  margin: auto;\r\n  background-color: #fff;\r\n  border-bottom: 1px solid rgb(244 244 244);\r\n}\r\n.title{\r\n  width: 740px;\r\n  height: 20px;\r\n  top: 10px;\r\n  left: 108px;\r\n  padding: 8px 16px 8px 16px;\r\n  border-radius: 16px;\r\n  border: 1px solid #DCDFE6;\r\n  margin: 0px 40px;\r\n}\r\n.title:focus{\r\n  outline: none;\r\n}\r\n\r\n.md-contain{\r\n  width: 1100px;\r\n  margin: auto;\r\n}\r\n.md{\r\n  overflow:scroll;\r\n}\r\n/* .large_submit1{\r\n    border-radius: 4px 4px 0px 0px;\r\n    background: #fff;\r\n    box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);\r\n    width: 1020px;\r\n    padding: 24px 40px 0px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    margin: 20px auto 0px;\r\n    gap:20px\r\n} */\r\nlabel{\r\n    color: #606266;\r\n    font-family: Microsoft YaHei;\r\n    font-size: 16px;\r\n    margin-right: 80px;\r\n    cursor: pointer;\r\n}\r\n/* .upload-container {\r\n    display: flex;\r\n    align-items: center;\r\n}\r\n\r\n.upload-label {\r\n    cursor: pointer;\r\n}\r\n.file-container {\r\n    min-width: 95px;\r\n    min-height: 25px;\r\n    border: 1px solid #bbbbbb;\r\n    border-radius: 10px;\r\n    padding: 5px 15px;\r\n    cursor: pointer;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n}\r\n.file-name{\r\n  font-size: 14px;\r\n  color: #606266;\r\n}\r\n.box1{\r\n  display: flex;\r\n  width: 780px;\r\n  height: 24px;\r\n  align-items: center;\r\n} */\r\n/* .tclass{\r\n    margin-right: 80px;\r\n    color: #606266;\r\n}\r\n.moneyInput{\r\n    margin-left: 94px;\r\n}\r\n.moneyInput span{\r\n    font-size: 14px;\r\n}\r\n.moneyInput .el-input{\r\n    width: 60px;\r\n    margin: 0px 5px;\r\n} */\r\n.el-input__inner{\r\n    text-align: center;\r\n}\r\n/* .image-container {\r\n    width: 180px;\r\n    height: 180px;\r\n    border: 1px dashed #bbbbbb;\r\n    border-radius: 10px;\r\n    cursor: pointer;\r\n    position: relative;\r\n}\r\ni.delete-btn2 {\r\n  position: absolute;\r\n  right: 5px;\r\n  top: 8px;\r\n  cursor: pointer;\r\n}\r\n\r\n.spic{\r\n    background-size: cover;\r\n    background-repeat: no-repeat;\r\n    background-position: center center;\r\n    width: 180px;\r\n    height: 180px;\r\n    border-radius: 10px;\r\n    border: 1px dashed #bbbbbb;\r\n} */\r\n.foot{\r\n  width: 100%;\r\n  height: 38px;\r\n  border-radius: 8px;\r\n  border: 1px solid #DCDFE6;\r\n  background: #FFF;\r\n  position: fixed;\r\n  bottom: 0;\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 0 10px 0 10px;\r\n  \r\n}\r\n.b-1{\r\n  display: inline-flex;\r\n  padding: 8px 16px;\r\n  justify-content: center;\r\n  align-items: center;\r\n  gap: 16px;\r\n  border-radius: 16px;\r\n  border: 1px solid #DCDFE6;\r\n  margin-right: 10px;\r\n  cursor: pointer;\r\n}\r\n.b-2{\r\n  display: inline-flex;\r\n  padding: 8px 16px;\r\n  justify-content: center;\r\n  align-items: center;\r\n  gap: 16px;\r\n  border-radius: 16px;\r\n  border: #FFF;\r\n  background: #9FA9CA;\r\n  cursor: pointer;\r\n}\r\n.b-container{\r\n  position: absolute;\r\n  right: 40px;\r\n}\r\n\r\n</style>"],"mappings":";;;EACOA,KAAK,EAAC;AAAU;;EACdC,KAAyG,EAAzG;IAAA;IAAA;IAAA;IAAA;EAAA;AAAyG;;EACvGD,KAAK,EAAC;AAAQ;;EAGdA,KAAK,EAAC;AAAY;;;uBAL3BE,mBAAA,CAwBM,OAxBNC,UAwBM,GAvBJC,mBAAA,CAYM,OAZNC,UAYM,GAXJD,mBAAA,CAEM,OAFNE,UAEM,G,gBADJF,mBAAA,CAAuE;IAAhEG,IAAI,EAAC,MAAM;IAACC,WAAW,EAAC,SAAS;IAACR,KAAK,EAAC,OAAO;+DAAUS,MAAA,CAAAC,KAAK,GAAAC,MAAA;iDAALF,MAAA,CAAAC,KAAK,E,KAEvEN,mBAAA,CAOM,OAPNQ,UAOM,GANJC,YAAA,CAKIC,sBAAA;gBAJOL,MAAA,CAAAM,IAAI;+DAAJN,MAAA,CAAAM,IAAI,GAAAJ,MAAA;IAAEK,MAAM,EAAC,OAAO;IAAChB,KAAK,EAAC,IAAI;IACxC,cAAY,EAAC,0HAA0H;IACtI,gBAAc,EAAE,EAAE;IAClBiB,aAAY,EAAER,MAAA,CAAAS;+CAIrBL,YAAA,CAAqEJ,MAAA;IAA9CU,MAAM,EAAIV,MAAA,CAAAW;EAAW,qCAC5CP,YAAA,CAAYJ,MAAA,eACZY,mBAAA,WAAc,EACdjB,mBAAA,CAMM;IANDJ,KAAK,EAAC;EAAM,IACfI,mBAAA,CAIM;IAJDJ,KAAK,EAAC;EAAa,IACtBI,mBAAA,CAA2D;IAAnDJ,KAAK,EAAC,KAAK;IAAEsB,OAAK,EAAEb,MAAA,CAAAc;KAAkB,MAAI,GAClDF,mBAAA,yCAA0C,EAC1CjB,mBAAA,CAA0D;IAAlDJ,KAAK,EAAC,KAAK;IAAEsB,OAAK,EAAEb,MAAA,CAAAe;KAAiB,MAAI,E"},"metadata":{},"sourceType":"module","externalDependencies":[]}