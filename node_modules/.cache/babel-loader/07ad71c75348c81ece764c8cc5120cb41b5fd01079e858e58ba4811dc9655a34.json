{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, resolveDirective as _resolveDirective, withDirectives as _withDirectives, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nimport _imports_0 from '@/assets/VerifiedUser.svg';\nimport _imports_1 from '@/assets/QACenter/QuestionMark.svg';\nimport _imports_2 from '@/assets/QACenter/ScoreStar.svg';\nimport _imports_3 from '@/assets/QACenter/FishPoint.svg';\nconst _withScopeId = n => (_pushScopeId(\"data-v-0a0a2bf4\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"part_2\",\n  \"infinite-scroll-distance\": \"100\",\n  \"infinite-scroll-immediate\": \"false\"\n};\nconst _hoisted_2 = {\n  class: \"item-left\"\n};\nconst _hoisted_3 = {\n  class: \"authorpic\"\n};\nconst _hoisted_4 = [\"src\", \"onClick\"];\nconst _hoisted_5 = {\n  class: \"info\"\n};\nconst _hoisted_6 = {\n  style: {\n    \"display\": \"flex\",\n    \"align-items\": \"center\",\n    \"gap\": \"3px\"\n  }\n};\nconst _hoisted_7 = {\n  key: 0,\n  src: _imports_0,\n  style: {\n    \"width\": \"16px\",\n    \"height\": \"16px\"\n  },\n  alt: \"\"\n};\nconst _hoisted_8 = {\n  class: \"middle\"\n};\nconst _hoisted_9 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"img\", {\n  src: _imports_1,\n  alt: \"\"\n}, null, -1 /* HOISTED */));\nconst _hoisted_10 = {\n  class: \"score\"\n};\nconst _hoisted_11 = {\n  class: \"field\"\n};\nconst _hoisted_12 = [\"onClick\"];\nconst _hoisted_13 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", {\n  style: {\n    \"display\": \"flex\",\n    \"align-items\": \"center\",\n    \"gap\": \"5px\"\n  }\n}, [/*#__PURE__*/_createElementVNode(\"img\", {\n  src: _imports_3,\n  alt: \"\"\n}), /*#__PURE__*/_createCommentVNode(\" <span class=\\\"text1 recommend\\\">推荐：</span>\\r\\n                    <span class=\\\"text2\\\">{{ source.priceLow }}~{{source.priceHigh}}起</span> \"), /*#__PURE__*/_createElementVNode(\"span\", {\n  class: \"text2\"\n}, \"免费\")], -1 /* HOISTED */));\nconst _hoisted_14 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", {\n  class: \"text1\"\n}, \"咨询\", -1 /* HOISTED */));\nconst _hoisted_15 = [_hoisted_13, _hoisted_14];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _directive_infinite_scroll = _resolveDirective(\"infinite-scroll\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createCommentVNode(\" <div class=\\\"part_1\\\">\\r\\n        <span class=\\\"toptext\\\">推荐答主</span>\\r\\n    </div> \"), _withDirectives((_openBlock(), _createElementBlock(\"div\", _hoisted_1, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.recommendedAnswererList, (source, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: \"item\"\n    }, [_createElementVNode(\"div\", _hoisted_2, [_createCommentVNode(\" 用户头像 \"), _createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"img\", {\n      src: source.newAvater,\n      onClick: $event => $setup.navigateToUserProfile(source.userId),\n      alt: \"\"\n    }, null, 8 /* PROPS */, _hoisted_4)]), _createCommentVNode(\" 用户名称+咨询信息 \"), _createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"span\", null, _toDisplayString(source.username), 1 /* TEXT */), source.verified === 1 ? (_openBlock(), _createElementBlock(\"img\", _hoisted_7)) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"div\", _hoisted_8, [_hoisted_9, _createElementVNode(\"span\", null, _toDisplayString(source.answerCount) + \"次咨询\", 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_10, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.getStarCount1(source.commentGrade), n => {\n      return _openBlock(), _createElementBlock(\"img\", {\n        key: n,\n        src: _imports_2,\n        alt: \"\"\n      });\n    }), 128 /* KEYED_FRAGMENT */)), _createElementVNode(\"span\", null, _toDisplayString(source.commentGrade), 1 /* TEXT */)])]), _createCommentVNode(\" 回答领域 \"), _createElementVNode(\"div\", _hoisted_11, _toDisplayString(source.answererInfo), 1 /* TEXT */)])]), _createCommentVNode(\" *鱼饵 起 咨询 \"), _createElementVNode(\"div\", {\n      class: \"consult_btn\",\n      onClick: $event => $setup.goToConsult(source.userId)\n    }, [..._hoisted_15], 8 /* PROPS */, _hoisted_12)]);\n  }), 128 /* KEYED_FRAGMENT */))])), [[_directive_infinite_scroll, $setup.load]])], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */);\n}","map":{"version":3,"names":["_imports_0","_imports_1","_imports_2","_imports_3","class","style","src","alt","_createElementVNode","_createCommentVNode","_hoisted_13","_hoisted_14","_createElementBlock","_hoisted_1","_Fragment","_renderList","$setup","recommendedAnswererList","source","index","key","_hoisted_2","_hoisted_3","newAvater","onClick","$event","navigateToUserProfile","userId","_hoisted_5","_hoisted_6","_toDisplayString","username","verified","_hoisted_7","_hoisted_8","_hoisted_9","answerCount","_hoisted_10","getStarCount1","commentGrade","n","_hoisted_11","answererInfo","goToConsult","load"],"sources":["D:\\有渔\\前端源码\\YouyuBBS-Q - 副本\\youyu-lyn-qtnew-vision-new-2024.1.14\\src\\page\\QACenter\\SquareQuestion\\QASquare.vue"],"sourcesContent":["<template>\r\n    <!-- <div class=\"part_1\">\r\n        <span class=\"toptext\">推荐答主</span>\r\n    </div> -->\r\n    <div class=\"part_2\" v-infinite-scroll=\"load\" infinite-scroll-distance=\"100\" infinite-scroll-immediate=\"false\">\r\n        <div v-for=\"(source,index) in recommendedAnswererList\" :key=\"index\" class=\"item\">\r\n            <div class=\"item-left\">\r\n                <!-- 用户头像 -->\r\n                <div class=\"authorpic\">\r\n                    <img :src=\"source.newAvater\"  @click=\"navigateToUserProfile(source.userId)\" alt=\"\">\r\n                </div>\r\n                <!-- 用户名称+咨询信息 -->\r\n                <div class=\"info\">\r\n                    <div style=\"display: flex;align-items: center;gap: 3px;\">\r\n                        <span>{{ source.username }}</span>\r\n                        <img  v-if=\"source.verified === 1\"  src=\"@/assets/VerifiedUser.svg\" style=\"width: 16px;height: 16px;\" alt=\"\">\r\n                    </div>\r\n                    <div class=\"middle\">\r\n                        <img src=\"@/assets/QACenter/QuestionMark.svg\" alt=\"\">\r\n                        <span>{{ source.answerCount }}次咨询</span>\r\n                        <div class=\"score\">\r\n                            <img v-for=\"n in getStarCount1(source.commentGrade)\" :key=\"n\" src=\"@/assets/QACenter/ScoreStar.svg\" alt=\"\">\r\n                            <span>{{ source.commentGrade }}</span>\r\n                        </div>\r\n                    </div>\r\n                    <!-- 回答领域 -->\r\n                    <div class=\"field\">\r\n                        {{ source.answererInfo }}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <!-- *鱼饵 起 咨询 -->\r\n            <div class=\"consult_btn\"  @click=\"goToConsult(source.userId)\">\r\n                <div style=\"display:flex; align-items: center; gap:5px;\">\r\n                    <img src=\"@/assets/QACenter/FishPoint.svg\" alt=\"\">\r\n                    <!-- <span class=\"text1 recommend\">推荐：</span>\r\n                    <span class=\"text2\">{{ source.priceLow }}~{{source.priceHigh}}起</span> -->\r\n                    <span class=\"text2\">免费</span>\r\n                </div>\r\n                <span class=\"text1\">咨询</span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref,onMounted } from 'vue'\r\nimport { useRouter } from 'vue-router';\r\nimport { ElMessage } from 'element-plus';\r\nimport axios from '@/utils/request';\r\nimport { getUsersAvatarFromCOS } from '@/utils/cosService';\r\nimport { openUrl } from '@/utils/routeJudge'\r\n\r\nconst currentPage = ref(1);\r\nconst router = useRouter()\r\nconst recommendedAnswererList = ref([]);\r\nconst userId = localStorage.getItem(\"userId\");\r\n\r\n//点击进入答主信息展示页面\r\nconst goToConsult = (id) =>{\r\n    // const routeLocation = router.resolve({ path: `/DefaultPresentation/AnswererBrief/${id}`});\r\n    // window.open(routeLocation.href, '_blank');\r\n    // const routeLocation = router.resolve({ path: `/DefaultPresentation/AnswererBrief/${id}` });\r\n    // window.open(routeLocation.href, '_blank');\r\n    openUrl(`/DefaultPresentation/AnswererBrief/${id}`)\r\n}\r\n\r\n//点击用户头像进行跳转到个人主页\r\nconst navigateToUserProfile = (user_id) => {\r\n    console.log('点击用户头像跳转');\r\n    if(user_id == userId){\r\n        // const routeLocation = router.resolve({ path: '/PersonalPage' });\r\n        // window.open(routeLocation.href, '_blank');\r\n        openUrl('/PersonalPage')\r\n    }else{\r\n        // const routeLocation = router.resolve({ path: `/OtherUserPersonalPage/${user_id}`});\r\n        // window.open(routeLocation.href, '_blank');\r\n        openUrl(`/OtherUserPersonalPage/${user_id}`)\r\n    }\r\n};\r\n\r\n//判断哦评价展示的星星数量\r\nconst getStarCount1 = (grade) =>{\r\n    const result = Math.floor(grade);\r\n    return result\r\n}\r\n\r\n\r\n// 添加一个锁状态\r\nlet isLoading = false;\r\nasync function load() {\r\n    if (isLoading) return; // 如果已经在加载中，则直接返回不执行新的加载\r\n    isLoading = true; // 开始加载数据，设置锁状态为true\r\n    try {\r\n        if(currentPage.value === 1){\r\n            currentPage.value++;\r\n        }\r\n        await getRecommendedAnswerer(currentPage.value);\r\n        currentPage.value++; // 只有在请求成功完成后才递增页码\r\n    } catch (error) {\r\n        console.error(error);\r\n        ElMessage.error('滚动时的未知错误');\r\n    } finally {\r\n        isLoading = false; // 请求完成，无论成功或失败，都释放锁状态\r\n    }\r\n}\r\n\r\n//获取推荐答主列表\r\nasync function getRecommendedAnswerer(currentPage) {\r\n  try{\r\n    const response = await axios.get(`/answer/answerer`, {\r\n        params: {\r\n            page:currentPage,\r\n            pageSize:10,\r\n        }\r\n    });\r\n    if (response.data.code === 1 && response.data.data.records.length > 0) {\r\n        const updates = response.data.data.records.map(async (record) => {\r\n            const verified = await fetchUserInformation(record.userId);\r\n            const newAvater = await getUsersAvatarFromCOS(record.userId);\r\n            const commentGrade = ref();\r\n            if(record.answerCount != 0){\r\n                commentGrade.value = (record.cumGrade/record.answerCount).toFixed(1);\r\n            }else{\r\n                commentGrade.value = 0;\r\n            }\r\n            const sliceanswererInfo = record.answererInfo.slice(0, 15);\r\n            return {\r\n                ...record,\r\n                verified,\r\n                newAvater,\r\n                commentGrade,\r\n                sliceanswererInfo\r\n            };\r\n        });\r\n        const updatedRecords = await Promise.all(updates);\r\n        recommendedAnswererList.value = [...recommendedAnswererList.value, ...updatedRecords];\r\n        // ElMessage.success('获取推荐答主列表成功');\r\n    }else if (response.data.code === 1 && response.data.data.records.length === 0) {\r\n        // ElMessage.info('已加载所有数据');\r\n    }else if(response.data.code === 0 && response.data.msg){\r\n        ElMessage.error(response.data.msg.toString());\r\n    }else{\r\n        console.error(\"获取推荐答主列表失败\");\r\n        ElMessage.error('获取推荐答主列表失败');\r\n    }\r\n  } catch (error) {\r\n    console.error(\"获取推荐答主列表失败\", error); \r\n    ElMessage.error('获取推荐答主列表失败');\r\n  }\r\n}\r\n\r\n\r\n// 获取用户信息\r\nconst fetchUserInformation = async (userId) => {\r\n    try {\r\n        const response = await axios.get(`/users/${userId}`);\r\n        if(response.data.code === 1){\r\n            return (response.data.data.verified);\r\n        }else if(response.data.code === 0 && response.data.msg){\r\n            ElMessage.error(response.data.msg.toString());\r\n        }else{\r\n            ElMessage.error('获取用户信息失败');\r\n        }\r\n    } catch (error) {\r\n        console.error(\"获取用户信息失败\", error);\r\n        ElMessage.error('获取用户信息失败');\r\n    }\r\n};\r\n\r\nonMounted(() => {\r\n    getRecommendedAnswerer(currentPage.value);\r\n})\r\n\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.toptext{\r\n    font-size: 20px;\r\n    font-weight: 700;\r\n}\r\n.part_2{\r\n    height: 86vh;\r\n    overflow: auto;\r\n    width: 100%;\r\n}\r\n.item{\r\n    width: 90%;\r\n    margin: 0px auto;\r\n    padding: 20px 0px;\r\n    border-bottom: 1px solid #EEE;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n}\r\n.item-left{\r\n    display: flex;\r\n    align-items: flex-start;\r\n    gap: 1rem;\r\n    width: 70%;\r\n}\r\n.authorpic img{\r\n    width: 60px;\r\n    height: 60px;\r\n    border-radius: 50%;\r\n    margin-bottom: 35px;\r\n    cursor: pointer;\r\n}\r\n.info{\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 7px;\r\n}\r\n.info span{\r\n    font-size: 15px;\r\n    font-weight: 700;\r\n    line-height: 1.6;\r\n}\r\n.middle{\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n}\r\n.middle img{\r\n    width: 12px;\r\n    height: 12px;\r\n}\r\n.middle span{\r\n    color: #7E7E7E;\r\n    font-size: 12px;\r\n}\r\n.score{\r\n    display: flex;\r\n    align-items: center;\r\n}\r\n.score img{\r\n    width: 16px;\r\n    height: 16px;\r\n}\r\n.score span{\r\n    color: #FACB25;\r\n    font-size: 12px;\r\n}\r\n.field{\r\n    width: 710px;\r\n    color: #000;\r\n    font-size: 14px;\r\n    line-height: 1.6;\r\n}\r\n.consult_btn{\r\n    height: 17px;\r\n    display: flex;\r\n    padding: 8px 12px;\r\n    justify-content: center;\r\n    align-items: center;\r\n    gap: 10px;\r\n    border-radius: 8px;\r\n    background: #9ba5c7;\r\n    margin-right: 20px;\r\n    cursor: pointer;\r\n}\r\n.consult_btn img{\r\n    width: 12px;\r\n    height: 12px;\r\n}\r\n.text1{\r\n    color: #46639D;\r\n    font-size: 14px;\r\n    line-height: 1.6;\r\n}\r\n.text2{\r\n    color: #FFF;\r\n    font-size: 14px;\r\n    line-height: 1.6; \r\n}\r\n/* 对手机屏幕和小尺寸屏幕的样式调整 */\r\n@media (max-width: 768px) {\r\n    .item{\r\n        padding: 1.5rem 0.5rem;\r\n        flex-direction: column;\r\n        align-items: flex-end;\r\n        gap: 1rem;\r\n    }\r\n    .item-left{\r\n        width: 100%;\r\n        gap: 0.8rem;\r\n    }\r\n    .authorpic img{\r\n        width: 2.5rem;\r\n        height: 2.5rem;\r\n    }\r\n    .info{\r\n        width: 27%;\r\n        gap: 0.6rem;\r\n    }\r\n    .consult_btn{\r\n        margin-right: 0px;\r\n    }\r\n    .middle,\r\n    .field{\r\n        width: 300%;\r\n    }\r\n    .recommend{\r\n        display: none;\r\n    }\r\n}\r\n</style>"],"mappings":";OAe4DA,UAA+B;OAG9DC,UAAwC;OAGqBC,UAAqC;OAatGC,UAAqC;;;EA9BrDC,KAAK,EAAC,QAAQ;EAA0B,0BAAwB,EAAC,KAAK;EAAC,2BAAyB,EAAC;;;EAEzFA,KAAK,EAAC;AAAW;;EAEbA,KAAK,EAAC;AAAW;;;EAIjBA,KAAK,EAAC;AAAM;;EACRC,KAAmD,EAAnD;IAAA;IAAA;IAAA;EAAA;AAAmD;;;EAEhBC,GAA+B,EAA/BN,UAA+B;EAACK,KAAiC,EAAjC;IAAA;IAAA;EAAA,CAAiC;EAACE,GAAG,EAAC;;;EAEzGH,KAAK,EAAC;AAAQ;gEACfI,mBAAA,CAAqD;EAAhDF,GAAwC,EAAxCL,UAAwC;EAACM,GAAG,EAAC;;;EAE7CH,KAAK,EAAC;AAAO;;EAMjBA,KAAK,EAAC;AAAO;;iEAOtBI,mBAAA,CAKM;EALDH,KAAmD,EAAnD;IAAA;IAAA;IAAA;EAAA;AAAmD,I,aACpDG,mBAAA,CAAkD;EAA7CF,GAAqC,EAArCH,UAAqC;EAACI,GAAG,EAAC;iBAC/CE,mBAAA,gJAC0E,E,aAC1ED,mBAAA,CAA6B;EAAvBJ,KAAK,EAAC;AAAO,GAAC,IAAE,E;iEAE1BI,mBAAA,CAA6B;EAAvBJ,KAAK,EAAC;AAAO,GAAC,IAAE;qBANtBM,WAKM,EACNC,WAA6B,C;;;6DAtCzCF,mBAAA,yFAEU,E,+BACVG,mBAAA,CAsCM,OAtCNC,UAsCM,I,kBArCFD,mBAAA,CAoCME,SAAA,QAAAC,WAAA,CApCwBC,MAAA,CAAAC,uBAAuB,GAAxCC,MAAM,EAACC,KAAK;yBAAzBP,mBAAA,CAoCM;MApCkDQ,GAAG,EAAED,KAAK;MAAEf,KAAK,EAAC;QACtEI,mBAAA,CAwBM,OAxBNa,UAwBM,GAvBFZ,mBAAA,UAAa,EACbD,mBAAA,CAEM,OAFNc,UAEM,GADFd,mBAAA,CAAmF;MAA7EF,GAAG,EAAEY,MAAM,CAACK,SAAS;MAAIC,OAAK,EAAAC,MAAA,IAAET,MAAA,CAAAU,qBAAqB,CAACR,MAAM,CAACS,MAAM;MAAGpB,GAAG,EAAC;2CAEpFE,mBAAA,eAAkB,EAClBD,mBAAA,CAiBM,OAjBNoB,UAiBM,GAhBFpB,mBAAA,CAGM,OAHNqB,UAGM,GAFFrB,mBAAA,CAAkC,cAAAsB,gBAAA,CAAzBZ,MAAM,CAACa,QAAQ,kBACZb,MAAM,CAACc,QAAQ,U,cAA3BpB,mBAAA,CAA6G,OAA7GqB,UAA6G,K,qCAEjHzB,mBAAA,CAOM,OAPN0B,UAOM,GANFC,UAAqD,EACrD3B,mBAAA,CAAwC,cAAAsB,gBAAA,CAA/BZ,MAAM,CAACkB,WAAW,IAAG,KAAG,iBACjC5B,mBAAA,CAGM,OAHN6B,WAGM,I,kBAFFzB,mBAAA,CAA2GE,SAAA,QAAAC,WAAA,CAA1FC,MAAA,CAAAsB,aAAa,CAACpB,MAAM,CAACqB,YAAY,GAAtCC,CAAC;2BAAb5B,mBAAA,CAA2G;QAArDQ,GAAG,EAAEoB,CAAC;QAAElC,GAAqC,EAArCJ,UAAqC;QAACK,GAAG,EAAC;;oCACxGC,mBAAA,CAAsC,cAAAsB,gBAAA,CAA7BZ,MAAM,CAACqB,YAAY,iB,KAGpC9B,mBAAA,UAAa,EACbD,mBAAA,CAEM,OAFNiC,WAEM,EAAAX,gBAAA,CADCZ,MAAM,CAACwB,YAAY,iB,KAIlCjC,mBAAA,cAAiB,EACjBD,mBAAA,CAQM;MARDJ,KAAK,EAAC,aAAa;MAAGoB,OAAK,EAAAC,MAAA,IAAET,MAAA,CAAA2B,WAAW,CAACzB,MAAM,CAACS,MAAM;;mEA5B5BX,MAAA,CAAA4B,IAAI,E"},"metadata":{},"sourceType":"module","externalDependencies":[]}