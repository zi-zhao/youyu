{"ast":null,"code":"import { ref, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport TitleSection from \"@/page/TheSettings/components/TitleSection.vue\";\nimport YyButton from \"@/page/components/YyButton.vue\";\nimport PwdChange from \"@/page/TheSettings/SecuLog/pwdChange.vue\";\nimport axios from '@/utils/request';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nexport default {\n  __name: 'LogExit',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const userId = localStorage.getItem(\"userId\"); // 获取用户ID\n    const msg = ref('登录信息');\n    const router = useRouter();\n    const showPwdDialog = ref(false);\n    const user = ref({});\n\n    //退出登录的弹框\n    const exitLogFunction = async () => {\n      try {\n        await ElMessageBox.confirm('确定要退出登录吗？', {\n          confirmButtonText: '确认退出',\n          cancelButtonText: '取消',\n          type: 'warning'\n        });\n        exitLog();\n      } catch {\n        console.log('关闭弹框');\n      }\n    };\n\n    //退出登录的接口\n    async function exitLog() {\n      // try {\n      //   const response = await axios.post('/user/logout');\n      //   if(response.data.code === 1){\n      localStorage.clear();\n      console.log('localStorage中的数据已被清理');\n      ElMessage.success('退出登录成功');\n      router.push('/');\n      // }else if(response.data.code === 0 && response.data.msg){\n      //   ElMessage.error(response.data.msg.toString());\n      // }else{\n      //   console.error(\"退出登录失败\");\n      //   ElMessage.error('退出登录失败');\n      // }\n      // } catch (error) {\n      //   console.error(\"退出登录失败\", error); \n      //   ElMessage.error('退出登录失败');\n      // }\n    }\n\n    // 获取用户信息\n    const fetchAvatar = async () => {\n      try {\n        const response = await axios.get(`/users/${userId}`);\n        if (response.data.code === 1) {\n          user.value = response.data.data;\n        } else if (response.data.code === 0 && response.data.msg) {\n          ElMessage.error(response.data.msg.toString());\n        } else {\n          ElMessage.error('获取用户信息失败');\n        }\n      } catch (error) {\n        console.error(\"获取用户信息失败\", error);\n        ElMessage.error('获取用户信息失败');\n      }\n    };\n    onMounted(() => {\n      fetchAvatar();\n    });\n    const __returned__ = {\n      userId,\n      msg,\n      router,\n      showPwdDialog,\n      user,\n      exitLogFunction,\n      exitLog,\n      fetchAvatar,\n      ref,\n      onMounted,\n      get useRouter() {\n        return useRouter;\n      },\n      TitleSection,\n      YyButton,\n      PwdChange,\n      get axios() {\n        return axios;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get ElMessageBox() {\n        return ElMessageBox;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","useRouter","TitleSection","YyButton","PwdChange","axios","ElMessage","ElMessageBox","userId","localStorage","getItem","msg","router","showPwdDialog","user","exitLogFunction","confirm","confirmButtonText","cancelButtonText","type","exitLog","console","log","clear","success","push","fetchAvatar","response","get","data","code","value","error","toString"],"sources":["D:/有渔/前端源码/YouyuBBS-Q - 副本/youyu-lyn-qtnew-vision-new-2024.1.14/src/page/TheSettings/SecuLog/LogExit.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <TitleSection :message=\"msg\" :show-btn=\"false\"/>\r\n  <div class=\"page\">\r\n    <div class=\"outside\">\r\n      <div class=\"left\">上次登录时间</div>\r\n      <div class=\"right\">{{ user.lastLoginTime }}</div>\r\n    </div>\r\n\r\n    <div class=\"outside\">\r\n      <div class=\"left\">上次登录地点</div>\r\n      <div class=\"right\">{{ user.lastLoginLocation }}</div>\r\n    </div>\r\n\r\n    <div class=\"outside\">\r\n      <div class=\"left\">上次登录IP</div>\r\n      <div class=\"right\">{{ user.lastLoginIp }}</div>\r\n    </div>\r\n\r\n    <!-- <div class=\"text-foot\">\r\n      根据登录时间，IP，地理位置，若判断为异常情况，请在核实后及时\r\n      <span class=\"pwdchange\" @click=\"showPwdDialog = true\">修改密码</span>\r\n    </div> -->\r\n    <el-dialog v-model=\"showPwdDialog\" width=\"70%\" title=\"修改密码\" @close=\"showPwdDialog = false\">\r\n      <PwdChange />\r\n    </el-dialog>\r\n    <YyButton theme=\"purple\" style=\"margin-top: 3rem;padding: 0.5rem 1rem;\" @click=\"exitLogFunction\"> 退出登录</YyButton>\r\n  </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref,onMounted } from 'vue';\r\nimport { useRouter } from 'vue-router';\r\nimport TitleSection from \"@/page/TheSettings/components/TitleSection.vue\";\r\nimport YyButton from \"@/page/components/YyButton.vue\";\r\nimport PwdChange from \"@/page/TheSettings/SecuLog/pwdChange.vue\";\r\nimport axios from '@/utils/request';\r\nimport { ElMessage,ElMessageBox} from 'element-plus';\r\n\r\nconst userId = localStorage.getItem(\"userId\"); // 获取用户ID\r\nconst msg = ref('登录信息');\r\nconst router = useRouter();\r\nconst showPwdDialog = ref(false);\r\nconst user = ref({});\r\n\r\n//退出登录的弹框\r\nconst exitLogFunction = async () => {\r\n  try {\r\n    await ElMessageBox.confirm(\r\n      '确定要退出登录吗？',\r\n      {\r\n        confirmButtonText: '确认退出',\r\n        cancelButtonText: '取消',\r\n        type: 'warning',\r\n      }\r\n    );\r\n    exitLog();\r\n  } catch {\r\n    console.log('关闭弹框')\r\n  }\r\n}\r\n\r\n//退出登录的接口\r\nasync function exitLog(){\r\n  // try {\r\n  //   const response = await axios.post('/user/logout');\r\n  //   if(response.data.code === 1){\r\n      localStorage.clear();\r\n      console.log('localStorage中的数据已被清理');\r\n      ElMessage.success('退出登录成功');\r\n      router.push('/');\r\n    // }else if(response.data.code === 0 && response.data.msg){\r\n    //   ElMessage.error(response.data.msg.toString());\r\n    // }else{\r\n    //   console.error(\"退出登录失败\");\r\n    //   ElMessage.error('退出登录失败');\r\n    // }\r\n  // } catch (error) {\r\n  //   console.error(\"退出登录失败\", error); \r\n  //   ElMessage.error('退出登录失败');\r\n  // }\r\n}\r\n\r\n// 获取用户信息\r\nconst fetchAvatar = async () => {\r\n  try {\r\n    const response = await axios.get(`/users/${userId}`);\r\n    if(response.data.code === 1){\r\n      user.value = response.data.data;\r\n    }else if(response.data.code === 0 && response.data.msg){\r\n      ElMessage.error(response.data.msg.toString());\r\n    }else{\r\n      ElMessage.error('获取用户信息失败');\r\n    }\r\n  } catch (error) {\r\n    console.error(\"获取用户信息失败\", error);\r\n    ElMessage.error('获取用户信息失败');\r\n  }\r\n};\r\n\r\n      \r\nonMounted(() => {\r\n  fetchAvatar();\r\n})\r\n\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.page{\r\n  margin-top: 5rem;\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-direction: column;\r\n  gap: 3rem;\r\n  padding: 0 12rem;\r\n}\r\n:deep .page .el-dialog__body{\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n}\r\n.outside{\r\n  display: flex;\r\n  justify-content: space-between;\r\n}\r\n\r\n.left{\r\n  flex: 50%;\r\n  text-align: left;\r\n  color: #7D7979;\r\n}\r\n\r\n.right{\r\n  flex: 50%;\r\n  text-align: left;\r\n}\r\n\r\n.text-foot{\r\n  margin-top: 3rem;\r\n  text-align: left;\r\n  color: #7D7979;\r\n}\r\n\r\n.pwdchange{\r\n  color: #60A7F3;\r\n  cursor: pointer;\r\n}\r\n</style>"],"mappings":"AAgCA,SAASA,GAAG,EAACC,SAAS,QAAQ,KAAK;AACnC,SAASC,SAAS,QAAQ,YAAY;AACtC,OAAOC,YAAY,MAAM,gDAAgD;AACzE,OAAOC,QAAQ,MAAM,gCAAgC;AACrD,OAAOC,SAAS,MAAM,0CAA0C;AAChE,OAAOC,KAAK,MAAM,iBAAiB;AACnC,SAASC,SAAS,EAACC,YAAY,QAAO,cAAc;;;;;;;IAEpD,MAAMC,MAAM,GAAGC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC;IAC/C,MAAMC,GAAG,GAAGZ,GAAG,CAAC,MAAM,CAAC;IACvB,MAAMa,MAAM,GAAGX,SAAS,CAAC,CAAC;IAC1B,MAAMY,aAAa,GAAGd,GAAG,CAAC,KAAK,CAAC;IAChC,MAAMe,IAAI,GAAGf,GAAG,CAAC,CAAC,CAAC,CAAC;;IAEpB;IACA,MAAMgB,eAAe,GAAG,MAAAA,CAAA,KAAY;MAClC,IAAI;QACF,MAAMR,YAAY,CAACS,OAAO,CACxB,WAAW,EACX;UACEC,iBAAiB,EAAE,MAAM;UACzBC,gBAAgB,EAAE,IAAI;UACtBC,IAAI,EAAE;QACR,CACF,CAAC;QACDC,OAAO,CAAC,CAAC;MACX,CAAC,CAAC,MAAM;QACNC,OAAO,CAACC,GAAG,CAAC,MAAM,CAAC;MACrB;IACF,CAAC;;IAED;IACA,eAAeF,OAAOA,CAAA,EAAE;MACtB;MACA;MACA;MACIX,YAAY,CAACc,KAAK,CAAC,CAAC;MACpBF,OAAO,CAACC,GAAG,CAAC,sBAAsB,CAAC;MACnChB,SAAS,CAACkB,OAAO,CAAC,QAAQ,CAAC;MAC3BZ,MAAM,CAACa,IAAI,CAAC,GAAG,CAAC;MAClB;MACA;MACA;MACA;MACA;MACA;MACF;MACA;MACA;MACA;IACF;;IAEA;IACA,MAAMC,WAAW,GAAG,MAAAA,CAAA,KAAY;MAC9B,IAAI;QACF,MAAMC,QAAQ,GAAG,MAAMtB,KAAK,CAACuB,GAAG,CAAE,UAASpB,MAAO,EAAC,CAAC;QACpD,IAAGmB,QAAQ,CAACE,IAAI,CAACC,IAAI,KAAK,CAAC,EAAC;UAC1BhB,IAAI,CAACiB,KAAK,GAAGJ,QAAQ,CAACE,IAAI,CAACA,IAAI;QACjC,CAAC,MAAK,IAAGF,QAAQ,CAACE,IAAI,CAACC,IAAI,KAAK,CAAC,IAAIH,QAAQ,CAACE,IAAI,CAAClB,GAAG,EAAC;UACrDL,SAAS,CAAC0B,KAAK,CAACL,QAAQ,CAACE,IAAI,CAAClB,GAAG,CAACsB,QAAQ,CAAC,CAAC,CAAC;QAC/C,CAAC,MAAI;UACH3B,SAAS,CAAC0B,KAAK,CAAC,UAAU,CAAC;QAC7B;MACF,CAAC,CAAC,OAAOA,KAAK,EAAE;QACdX,OAAO,CAACW,KAAK,CAAC,UAAU,EAAEA,KAAK,CAAC;QAChC1B,SAAS,CAAC0B,KAAK,CAAC,UAAU,CAAC;MAC7B;IACF,CAAC;IAGDhC,SAAS,CAAC,MAAM;MACd0B,WAAW,CAAC,CAAC;IACf,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}