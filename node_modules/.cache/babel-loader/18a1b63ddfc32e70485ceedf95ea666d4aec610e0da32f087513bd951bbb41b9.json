{"ast":null,"code":"import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, createBlock as _createBlock, resolveDirective as _resolveDirective, withDirectives as _withDirectives, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nimport _imports_0 from '@/assets/LikeBefore.svg';\nimport _imports_1 from '@/assets/Comment.svg';\nimport _imports_2 from '@/assets/Transpond.svg';\nimport _imports_3 from '@/assets/FavoriteBefore.svg';\nconst _withScopeId = n => (_pushScopeId(\"data-v-23ea2750\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"main_2\"\n};\nconst _hoisted_2 = {\n  class: \"pageshow\",\n  \"infinite-scroll-distance\": \"100\",\n  \"infinite-scroll-immediate\": \"false\"\n};\nconst _hoisted_3 = {\n  class: \"card\"\n};\nconst _hoisted_4 = {\n  style: {\n    \"display\": \"flex\",\n    \"flex-direction\": \"column\"\n  }\n};\nconst _hoisted_5 = {\n  class: \"phtitle\"\n};\nconst _hoisted_6 = {\n  class: \"chtitle multi-line-ellipsis-4\"\n};\nconst _hoisted_7 = {\n  class: \"icon_container\"\n};\nconst _hoisted_8 = {\n  class: \"cri\"\n};\nconst _hoisted_9 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"img\", {\n  class: \"like-pic\",\n  src: _imports_0\n}, null, -1 /* HOISTED */));\nconst _hoisted_10 = {\n  class: \"cname\"\n};\nconst _hoisted_11 = {\n  class: \"cri\"\n};\nconst _hoisted_12 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"img\", {\n  class: \"like-pic\",\n  src: _imports_1\n}, null, -1 /* HOISTED */));\nconst _hoisted_13 = {\n  class: \"cname\"\n};\nconst _hoisted_14 = {\n  class: \"cri\"\n};\nconst _hoisted_15 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"img\", {\n  class: \"like-pic\",\n  src: _imports_2\n}, null, -1 /* HOISTED */));\nconst _hoisted_16 = {\n  class: \"cname\"\n};\nconst _hoisted_17 = {\n  class: \"cri\"\n};\nconst _hoisted_18 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"img\", {\n  class: \"like-pic\",\n  src: _imports_3\n}, null, -1 /* HOISTED */));\nconst _hoisted_19 = {\n  class: \"cname\"\n};\nconst _hoisted_20 = [\"src\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_card = _resolveComponent(\"el-card\");\n  const _component_el_timeline_item = _resolveComponent(\"el-timeline-item\");\n  const _component_el_timeline = _resolveComponent(\"el-timeline\");\n  const _component_el_empty = _resolveComponent(\"el-empty\");\n  const _directive_infinite_scroll = _resolveDirective(\"infinite-scroll\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_withDirectives((_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createVNode(_component_el_timeline, null, {\n    default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.articleData, item => {\n      return _openBlock(), _createBlock(_component_el_timeline_item, {\n        key: item.id,\n        timestamp: item.createTime,\n        placement: \"top\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_card, null, {\n          default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_3, [_createCommentVNode(\" 左侧标题，简介，点赞等图标 \"), _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"h1\", _hoisted_5, _toDisplayString(item.title), 1 /* TEXT */), _createElementVNode(\"p\", _hoisted_6, _toDisplayString(item.summary), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"div\", _hoisted_8, [_hoisted_9, _createElementVNode(\"span\", _hoisted_10, _toDisplayString(item.likeCount), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_11, [_hoisted_12, _createElementVNode(\"span\", _hoisted_13, _toDisplayString(item.commentCount), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_14, [_hoisted_15, _createElementVNode(\"span\", _hoisted_16, _toDisplayString(item.transmitCount), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_17, [_hoisted_18, _createElementVNode(\"span\", _hoisted_19, _toDisplayString(item.favoriteCount), 1 /* TEXT */)])])]), _createCommentVNode(\" 右侧封面图片 \"), _createElementVNode(\"div\", null, [(_openBlock(), _createElementBlock(\"img\", {\n            src: item.newCoverPicture,\n            key: _ctx.imgIndex,\n            alt: \"Share Image\",\n            class: \"pic\"\n          }, null, 8 /* PROPS */, _hoisted_20))])])]),\n          _: 2 /* DYNAMIC */\n        }, 1024 /* DYNAMIC_SLOTS */)]),\n        _: 2 /* DYNAMIC */\n      }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"timestamp\"]);\n    }), 128 /* KEYED_FRAGMENT */))]),\n    _: 1 /* STABLE */\n  }), $setup.articleData.length === 0 || !$setup.articleData ? (_openBlock(), _createBlock(_component_el_empty, {\n    key: 0,\n    \"image-size\": 200,\n    description: \"您还没有文章呢，快去创作吧！\"\n  })) : _createCommentVNode(\"v-if\", true)])), [[_directive_infinite_scroll, $setup.load]])]);\n}","map":{"version":3,"names":["_imports_0","_imports_1","_imports_2","_imports_3","class","style","_createElementVNode","src","_createElementBlock","_hoisted_1","_hoisted_2","_createVNode","_component_el_timeline","_Fragment","_renderList","$setup","articleData","item","_createBlock","_component_el_timeline_item","key","id","timestamp","createTime","placement","_component_el_card","_hoisted_3","_createCommentVNode","_hoisted_4","_hoisted_5","_toDisplayString","title","_hoisted_6","summary","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","likeCount","_hoisted_11","_hoisted_12","_hoisted_13","commentCount","_hoisted_14","_hoisted_15","_hoisted_16","transmitCount","_hoisted_17","_hoisted_18","_hoisted_19","favoriteCount","newCoverPicture","_ctx","imgIndex","alt","length","_component_el_empty","description","load"],"sources":["D:\\有渔\\前端源码\\YouyuBBS-Q - 副本\\youyu-lyn-qtnew-vision-new-2024.1.14\\src\\page\\Personalpage\\dynamic\\ArticleComponent.vue"],"sourcesContent":["<template>\r\n  <div class=\"main_2\">\r\n    <div class=\"pageshow\"  v-infinite-scroll=\"load\" infinite-scroll-distance=\"100\" infinite-scroll-immediate=\"false\">\r\n      <el-timeline>\r\n        <el-timeline-item v-for=\"item in articleData\" :key=\"item.id\" :timestamp=\"item.createTime\" placement=\"top\">          \r\n          <el-card>\r\n            <div class=\"card\">\r\n              <!-- 左侧标题，简介，点赞等图标 -->\r\n              <div style=\"display: flex;flex-direction: column;\">\r\n                <h1 class=\"phtitle\">{{ item.title }}</h1>\r\n                <p class=\"chtitle multi-line-ellipsis-4\">{{ item.summary }}</p>\r\n                <div class=\"icon_container\">\r\n                  <div class=\"cri\">\r\n                    <img class=\"like-pic\" src=\"@/assets/LikeBefore.svg\" />\r\n                    <span class=\"cname\">{{ item.likeCount }}</span>\r\n                  </div>\r\n                  <div class=\"cri\">\r\n                    <img class=\"like-pic\" src=\"@/assets/Comment.svg\" />\r\n                    <span class=\"cname\">{{ item.commentCount }}</span>\r\n                  </div>\r\n                  <div class=\"cri\">\r\n                    <img class=\"like-pic\" src=\"@/assets/Transpond.svg\" />\r\n                    <span class=\"cname\">{{ item.transmitCount }}</span>\r\n                  </div>\r\n                  <div class=\"cri\">\r\n                    <img class=\"like-pic\" src=\"@/assets/FavoriteBefore.svg\" />\r\n                    <span class=\"cname\">{{ item.favoriteCount }}</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <!-- 右侧封面图片 -->\r\n              <div>\r\n                <img \r\n                  :src='item.newCoverPicture'  \r\n                  :key=\"imgIndex\" \r\n                  alt=\"Share Image\"\r\n                  class=\"pic\" \r\n                /> \r\n              </div>  \r\n            </div>\r\n          </el-card>\r\n        </el-timeline-item>\r\n      </el-timeline>\r\n      <el-empty \r\n          v-if=\"articleData.length === 0 || !articleData\" \r\n          :image-size=\"200\" \r\n          description=\"您还没有文章呢，快去创作吧！\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n\r\n<script setup>\r\nimport { ref,onMounted } from 'vue';\r\nimport axios from '@/utils/request';\r\nimport { getArticleCoverageFromCOS } from '@/utils/cosService';\r\nimport { ElMessage } from 'element-plus';\r\nimport { convertDateFormat } from '@/utils/timeFormat'; \r\nimport { getUsersAvatarFromCOS } from '@/utils/cosService';\r\n\r\nconst currentPage =ref(1);\r\nconst articleData = ref([]);\r\nconst userId = parseInt(localStorage.getItem(\"userId\")); // 获取用户ID\r\n\r\n\r\n// 添加一个锁状态\r\nlet isLoading = false;\r\nasync function load() {\r\n    if (isLoading) return; // 如果已经在加载中，则直接返回不执行新的加载\r\n    isLoading = true; // 开始加载数据，设置锁状态为true\r\n    try {\r\n      if(currentPage.value === 1){\r\n          currentPage.value++;\r\n      }\r\n      await getDynamicData(currentPage.value);\r\n      currentPage.value++; // 只有在请求成功完成后才递增页码\r\n    } catch (error) {\r\n        console.error(error);\r\n        ElMessage.error('滚动时的未知错误');\r\n    } finally {\r\n        isLoading = false; // 请求完成，无论成功或失败，都释放锁状态\r\n    }\r\n}\r\n\r\n // 获取分享和文章数据\r\n  async function getDynamicData(currentPage) {\r\n    try{\r\n      const response = await axios.get(`/users/works`,{\r\n          params: {\r\n              userId:userId,\r\n              page:currentPage,\r\n              pageSize:10,\r\n              type:0,\r\n          }\r\n      });\r\n      if (response.data.code === 1 && response.data.data.records.length > 0) {\r\n        const updates = response.data.data.records.map(async (record) => {\r\n          const avatarPromise = getUsersAvatarFromCOS(record.userId);\r\n          const coverPicturePromise = getArticleCoverageFromCOS(record.id);\r\n          const [avatar, newCoverPicture] = await Promise.all([avatarPromise, coverPicturePromise]);\r\n          const createTime = convertDateFormat(record.createTime);\r\n          return {\r\n            ...record,\r\n            avatar,\r\n            newCoverPicture,\r\n            createTime\r\n          };\r\n        });\r\n        const updatedRecords = await Promise.all(updates);\r\n        articleData.value = [...articleData.value, ...updatedRecords];\r\n        // ElMessage.success('获取用户动态成功');\r\n      }else if (response.data.code === 1 && response.data.data.records.length === 0) {\r\n          // ElMessage.info('已加载所有数据');\r\n      }else if(response.data.code === 0 && response.data.msg){\r\n          ElMessage.error(response.data.msg.toString());\r\n      }else{\r\n          console.error(\"获取用户动态失败\");\r\n          ElMessage.error('获取用户动态失败');\r\n      }\r\n    } catch (error) {\r\n      console.error(\"获取用户动态失败\", error); \r\n      ElMessage.error('获取用户动态失败');\r\n    }\r\n  }\r\n\r\n      // const goToDetail = (item) =>{\r\n    //       const routeLocation = router.resolve({ path: `/TheArticle/${item.articleId}`});\r\n    //       window.open(routeLocation.href, '_blank');\r\n    //   }\r\n  \r\n  onMounted(() => {\r\n    getDynamicData(currentPage.value);\r\n  })\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.main_2 {\r\n  display: flex;\r\n  padding-left: 0px;\r\n  flex-direction: column;\r\n  align-items: flex-start;\r\n  flex-shrink: 0;\r\n  min-height: 225px;\r\n}\r\n.pageshow {\r\n  width: 90%;\r\n  gap: 12px;\r\n  margin: 30px auto 0px;\r\n  min-height: 100px;\r\n}\r\n.card{\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n.phtitle {\r\n  color: #000;\r\n  font-family: Microsoft YaHei;\r\n  font-size: 16px;\r\n  font-style: normal;\r\n  font-weight: 700;\r\n  line-height: 120%; \r\n}\r\n.chtitle {\r\n  min-height: 58px;\r\n  width: 500px;\r\n  line-height: 1.6;\r\n  font-size: 14px;\r\n}\r\n.icon_container {\r\n  display: flex;\r\n  gap: 20px;\r\n  width: 500px;\r\n  margin-top: 20px;\r\n}\r\n.cri {\r\n  display: flex;\r\n  gap: 4px;\r\n}\r\n\r\n.like-pic {\r\n    display: block;\r\n    margin: auto;\r\n    height: 16px;\r\n    width: 16px;\r\n    margin-right: 2px;\r\n    cursor: pointer;\r\n}\r\n.cname{\r\n  color: #2d2d2d;\r\n  font-size: 13px;\r\n  line-height: 120%;\r\n}\r\n.pic{\r\n  width: 200px;\r\n  height: 140px;\r\n  flex-shrink: 0;\r\n  border-radius: 8px;\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}