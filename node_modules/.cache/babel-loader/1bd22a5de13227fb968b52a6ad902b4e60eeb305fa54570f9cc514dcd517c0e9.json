{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, withModifiers as _withModifiers, normalizeClass as _normalizeClass, createTextVNode as _createTextVNode, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-46548396\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"form\"\n};\nconst _hoisted_2 = [\"disabled\"];\nconst _hoisted_3 = [\"disabled\"];\nconst _hoisted_4 = {\n  class: \"center-button\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n  const _component_el_form = _resolveComponent(\"el-form\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", _hoisted_1, [_createVNode(_component_el_form, {\n    ref: \"myForm\",\n    \"label-position\": $setup.labelPosition,\n    \"label-width\": \"100px\",\n    model: $setup.formLabelAlign,\n    rules: $setup.rules,\n    onSubmit: _withModifiers($setup.fetchLoad, [\"prevent\"]),\n    class: _normalizeClass({\n      'form-touched': $setup.formTouched.valueOf\n    })\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_form_item, {\n      label: \"手机号\",\n      prop: \"phoneNumber\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: $setup.formLabelAlign.phoneNumber,\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.formLabelAlign.phoneNumber = $event),\n        onInput: $setup.checkPhoneNumber,\n        onChange: $setup.checkAllFields\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createCommentVNode(\" <el-form-item label=\\\"邮箱\\\" prop=\\\"email\\\">\\r\\n          <el-input v-model=\\\"formLabelAlign.email\\\" @change=\\\"checkAllFields\\\" />\\r\\n        </el-form-item> \"), _createVNode(_component_el_form_item, {\n      label: \"验证码\",\n      prop: \"phoneVerification\",\n      class: \"send-identifycode\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        class: \"two\",\n        modelValue: $setup.formLabelAlign.phoneVerification,\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.formLabelAlign.phoneVerification = $event),\n        onChange: $setup.checkAllFields\n      }, null, 8 /* PROPS */, [\"modelValue\"]), _createElementVNode(\"button\", {\n        class: \"send-pc\",\n        onClick: $setup.send,\n        disabled: !$setup.phoneNumberValid || $setup.isRunning\n      }, _toDisplayString($setup.inner), 9 /* TEXT, PROPS */, _hoisted_2), _createElementVNode(\"div\", {\n        class: \"send-phone\",\n        onClick: $setup.send,\n        disabled: !$setup.phoneNumberValid || $setup.isRunning\n      }, \"点击获取验证码\", 8 /* PROPS */, _hoisted_3)]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"label-position\", \"model\", \"rules\", \"onSubmit\", \"class\"])]), _createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_el_button, {\n    type: \"primary\",\n    round: \"\",\n    style: {\n      \"height\": \"45px\",\n      \"width\": \"141px\"\n    },\n    onClick: $setup.fetchLoad,\n    modelValue: $setup.isRunning,\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.isRunning = $event)\n  }, {\n    default: _withCtx(() => [_createTextVNode(\"登录\")]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\"]), _createCommentVNode(\" 注意这里要加一个点击事件，点击关闭登录弹框，打开注册弹框 \"), _createCommentVNode(\" <div class=\\\"noaccount\\\">没有账号?<span style=\\\"color: #00A6DA;\\\">去注册</span></div> \")])], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["class","_createElementVNode","_hoisted_1","_createVNode","_component_el_form","ref","$setup","labelPosition","model","formLabelAlign","rules","onSubmit","_withModifiers","fetchLoad","_normalizeClass","formTouched","valueOf","_component_el_form_item","label","prop","_component_el_input","phoneNumber","$event","onInput","checkPhoneNumber","onChange","checkAllFields","_createCommentVNode","phoneVerification","onClick","send","disabled","phoneNumberValid","isRunning","inner","_hoisted_2","_hoisted_3","_hoisted_4","_component_el_button","type","round","style"],"sources":["D:\\有渔\\前端源码\\YouyuBBS-Q - 副本\\youyu-lyn-qtnew-vision-new-2024.1.14\\src\\page\\TheFirst\\components\\TheDialog\\IdentifyPart.vue"],"sourcesContent":["<template>\r\n    <div class=\"form\">\r\n        <el-form\r\n        ref=\"myForm\"\r\n        :label-position=\"labelPosition\"\r\n        label-width=\"100px\"\r\n        :model=\"formLabelAlign\"\r\n        :rules=\"rules\"\r\n        @submit.prevent=\"fetchLoad\"\r\n        :class=\"{ 'form-touched': formTouched.valueOf }\"\r\n      >\r\n        <el-form-item label=\"手机号\" prop=\"phoneNumber\">\r\n          <el-input v-model=\"formLabelAlign.phoneNumber\" @input=\"checkPhoneNumber\" @change=\"checkAllFields\" />\r\n        </el-form-item>\r\n        <!-- <el-form-item label=\"邮箱\" prop=\"email\">\r\n          <el-input v-model=\"formLabelAlign.email\" @change=\"checkAllFields\" />\r\n        </el-form-item> -->\r\n        <el-form-item label=\"验证码\" prop=\"phoneVerification\" class=\"send-identifycode\">\r\n          <el-input class=\"two\" v-model=\"formLabelAlign.phoneVerification\" @change=\"checkAllFields\" />\r\n          <button class=\"send-pc\" @click=\"send\" :disabled=\" !phoneNumberValid ||isRunning\">{{ inner }}</button>\r\n          <div class=\"send-phone\" @click=\"send\" :disabled=\" !phoneNumberValid ||isRunning\">点击获取验证码</div>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n    <div class=\"center-button\">\r\n      <el-button type=\"primary\" round style=\"height: 45px;width: 141px;\" @click=\"fetchLoad\" v-model=\"isRunning\">登录</el-button>\r\n      <!-- 注意这里要加一个点击事件，点击关闭登录弹框，打开注册弹框 -->\r\n      <!-- <div class=\"noaccount\">没有账号?<span style=\"color: #00A6DA;\">去注册</span></div> -->\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {ref,reactive} from 'vue'\r\nimport axios from '@/utils/request'\r\nimport { useRouter } from 'vue-router'\r\nimport { useStore } from 'vuex';\r\nimport { ElMessage } from 'element-plus';\r\n\r\nconst myForm = ref(null);\r\nconst router = useRouter();\r\nconst labelPosition = ref('top');\r\nlet isRunning = ref(false);// 判断发送验证码事件\r\nlet allFieldsValid = ref(false);//所有表单是否符合规则\r\nlet phoneNumberValid = ref(false);//手机号是否符合规则\r\nlet formTouched = ref(false);//用户是否输入内容\r\nconst store = useStore();\r\nlet formLabelAlign = reactive({\r\n  phoneNumber: '',\r\n  phoneVerification: '',\r\n  // email:'',\r\n  // emailVerification:'',\r\n});  // 收集表单数据\r\nlet inner = ref('获取短信验证码');// 设置发送验证码按钮内容\r\n\r\n// 设置表单校验规则\r\nconst rules = reactive({\r\n  // email: [\r\n  //   { required: true, message: '请输入邮箱', trigger: 'blur' },\r\n  //   { pattern: /^[A-Za-z0-9_.-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,4}$/, message: '邮箱格式不正确', trigger: 'blur' }\r\n  // ],\r\n  // emailVerification:[\r\n  //   {required: true, message: '请输入验证码', trigger: 'blur'}\r\n  // ],\r\n  phoneNumber:[\r\n    {required: true, message: '请输入手机号', trigger: 'blur'},\r\n    {\r\n      validator: ( rules ,value, callback) => {\r\n        if (/^1[3-9]\\d{9}$/.test(value)) {\r\n          phoneNumberValid.value = true;\r\n          callback();\r\n        } else {\r\n          phoneNumberValid.value = false;\r\n          callback(new Error('手机号格式不正确'));\r\n        }\r\n      },\r\n      trigger: 'blur'\r\n    }   \r\n  ]\r\n})\r\n\r\n// 手机号验证函数\r\nfunction checkPhoneNumber() {\r\n  const phoneNumberPattern = /^1[3-9]\\d{9}$/;\r\n  phoneNumberValid.value = phoneNumberPattern.test(formLabelAlign.phoneNumber);\r\n  checkAllFields();\r\n}\r\n \r\n//验证输入框是否符合规则\r\nasync function checkAllFields() {\r\n  formTouched.value = true;\r\n  myForm.value.validate(valid => {\r\n    allFieldsValid.value = valid;\r\n  });\r\n}\r\n\r\n// 点击发送验证码\r\nasync function send(){\r\n  if(!isRunning.value){\r\n    isRunning.value = true\r\n    fetchData()\r\n    let time = ref(60);\r\n    let timeId = setInterval(function(){\r\n      time.value--;\r\n      inner.value = time.value+'后重新获取';\r\n      if(time.value===0){\r\n        clearInterval(timeId);\r\n        inner.value = '获取短信验证码';\r\n        isRunning.value = false;\r\n      }\r\n    },1000)\r\n  }\r\n}\r\n\r\n// 发送手机获取验证码请求\r\nasync function fetchData() {\r\n  try {\r\n    const response = await axios.get(`/sendLoginSMSCode/${formLabelAlign.phoneNumber}`);\r\n    // const response = await axios.get(`/sendEmailVerification/0/${formLabelAlign.email}`);\r\n    if (response.data.code === 1) {\r\n      ElMessage.success('手机验证码发送成功');\r\n    } else if(response.data.code === 0 && response.data.msg){\r\n      ElMessage.error(response.data.msg.toString());\r\n    }else {\r\n      console.log('手机验证码发送失败');\r\n      ElMessage.error('手机验证码发送失败');\r\n    }\r\n  } catch (error) {\r\n    console.error(error);\r\n    ElMessage.error('手机验证码发送失败');\r\n  }\r\n}\r\n\r\n// 发送验证码登录信息数据请求\r\nasync function fetchLoad() {\r\n  myForm.value.validate((valid) => {\r\n  if (valid) {\r\n    axios.post('/users/loginByVerification',formLabelAlign)\r\n    .then(response => {\r\n      if (response.data.code === 1 ) { \r\n        if(response.headers[\"authorization\"]){\r\n          localStorage.setItem('token',response.headers[\"authorization\"])\r\n          localStorage.setItem('userId',response.data.data.id)\r\n          localStorage.setItem('userName',response.data.data.username)\r\n          ElMessage.success('登录成功');\r\n          store.commit('DOWNLOAD', false)// 关闭登录dialog \r\n          // router.push('/VideoMain');\r\n          router.push('/DefaultPresentation');\r\n        }else{\r\n          ElMessage.error('登录失败'); \r\n        }              \r\n      } else if(response.data.code === 0 && response.data.msg){\r\n        ElMessage.error(response.data.msg.toString());\r\n      }else {\r\n        console.log(response.data);\r\n        ElMessage.error('登录失败'); \r\n      }\r\n    })\r\n    .catch(error => {\r\n      console.error(error);\r\n    });\r\n  }\r\n  else {\r\n      console.log('error submit!!');\r\n      return false;\r\n    }\r\n  })\r\n}\r\n\r\n// 发送邮箱验证码登录信息数据请求\r\n// async function fetchLoad() {\r\n//   myForm.value.validate((valid) => {\r\n//   if (valid) {\r\n//     axios.post('/users/loginByEmailVerification',formLabelAlign)\r\n//     .then(response => {\r\n//       if (response.data.code === 1 ) { \r\n//         if(response.headers[\"authorization\"]){\r\n//           localStorage.setItem('token',response.headers[\"authorization\"]);\r\n//           localStorage.setItem('userId',response.data.data.id);\r\n//           localStorage.setItem('userName',response.data.data.username);\r\n//           ElMessage.success('登录成功');\r\n//           store.commit('DOWNLOAD', false);// 关闭登录dialog \r\n//           router.push('/TheMain');\r\n//         }else{\r\n//           ElMessage.error('登录失败'); \r\n//         }              \r\n//       } else if(response.data.code === 0 && response.data.msg){\r\n//         ElMessage.error(response.data.msg.toString());\r\n//       }else {\r\n//         console.log(response.data);\r\n//         ElMessage.error('登录失败'); \r\n//       }\r\n//     })\r\n//     .catch(error => {\r\n//       console.error(error);\r\n//     });\r\n//   }\r\n//   else {\r\n//       console.log('error submit!!');\r\n//       return false;\r\n//     }\r\n//   })\r\n// }\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.form{\r\n\twidth: 100%;\r\n  margin: 3rem auto;\r\n}\r\n\r\n.center-button{\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  margin-right: 40px;\r\n  position: relative;\r\n}\r\n.send-pc{\r\n  display: inline-block;\r\n\twidth: 137px;\r\n\theight: 40px;\r\n\tbackground-color: #d5e3f2;\r\n\tbox-shadow: 0px 4px 4px 0px \r\n\t\t#b8cdf8;\r\n\tborder-radius: 4px;\r\n\tborder: solid 1px #d9d9d9;\r\n  margin-left: 20px;\r\n  cursor: pointer;\r\n}\r\n.send-phone{\r\n  display: none;\r\n}\r\n:deep .send-identifycode .el-form-item__content{\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: flex-end;\r\n  gap: 1rem;\r\n}\r\n:deep .el-form-item__error {\r\n  top: 45px;\r\n}\r\n.noaccount{\r\n  position: absolute;\r\n  right: 5%;\r\n  font-size: 0.8rem;\r\n  cursor: pointer;\r\n  letter-spacing: 1px;\r\n}\r\n@media (max-width: 768px) {\r\n  .form {\r\n    width: 90%;\r\n    margin: 4rem auto;\r\n  }\r\n  .form .el-form-item {\r\n    margin-bottom: 2rem;\r\n  }\r\n  .center-button{\r\n    margin-right: 0;\r\n  }\r\n  .send-pc{\r\n    display: none;\r\n  }\r\n  .send-phone{\r\n    display: flex;\r\n    color:  #2b6ae8;\r\n    line-height: 1.6;\r\n    font-size: 0.8rem;\r\n    cursor: pointer;\r\n    height: 40px;\r\n  }\r\n}\r\n</style>"],"mappings":";;;EACSA,KAAK,EAAC;AAAM;;;;EAuBZA,KAAK,EAAC;AAAe;;;;;;6DAvB1BC,mBAAA,CAsBM,OAtBNC,UAsBM,GArBFC,YAAA,CAoBQC,kBAAA;IAnBRC,GAAG,EAAC,QAAQ;IACX,gBAAc,EAAEC,MAAA,CAAAC,aAAa;IAC9B,aAAW,EAAC,OAAO;IAClBC,KAAK,EAAEF,MAAA,CAAAG,cAAc;IACrBC,KAAK,EAAEJ,MAAA,CAAAI,KAAK;IACZC,QAAM,EAAAC,cAAA,CAAUN,MAAA,CAAAO,SAAS;IACzBb,KAAK,EAAAc,eAAA;MAAA,gBAAoBR,MAAA,CAAAS,WAAW,CAACC;IAAO;;sBAE7C,MAEe,CAFfb,YAAA,CAEec,uBAAA;MAFDC,KAAK,EAAC,KAAK;MAACC,IAAI,EAAC;;wBAC7B,MAAoG,CAApGhB,YAAA,CAAoGiB,mBAAA;oBAAjFd,MAAA,CAAAG,cAAc,CAACY,WAAW;mEAA1Bf,MAAA,CAAAG,cAAc,CAACY,WAAW,GAAAC,MAAA;QAAGC,OAAK,EAAEjB,MAAA,CAAAkB,gBAAgB;QAAGC,QAAM,EAAEnB,MAAA,CAAAoB;;;QAEpFC,mBAAA,iKAEmB,EACnBxB,YAAA,CAIec,uBAAA;MAJDC,KAAK,EAAC,KAAK;MAACC,IAAI,EAAC,mBAAmB;MAACnB,KAAK,EAAC;;wBACvD,MAA4F,CAA5FG,YAAA,CAA4FiB,mBAAA;QAAlFpB,KAAK,EAAC,KAAK;oBAAUM,MAAA,CAAAG,cAAc,CAACmB,iBAAiB;mEAAhCtB,MAAA,CAAAG,cAAc,CAACmB,iBAAiB,GAAAN,MAAA;QAAGG,QAAM,EAAEnB,MAAA,CAAAoB;+CAC1EzB,mBAAA,CAAqG;QAA7FD,KAAK,EAAC,SAAS;QAAE6B,OAAK,EAAEvB,MAAA,CAAAwB,IAAI;QAAGC,QAAQ,GAAIzB,MAAA,CAAA0B,gBAAgB,IAAG1B,MAAA,CAAA2B;0BAAc3B,MAAA,CAAA4B,KAAK,wBAAAC,UAAA,GACzFlC,mBAAA,CAA8F;QAAzFD,KAAK,EAAC,YAAY;QAAE6B,OAAK,EAAEvB,MAAA,CAAAwB,IAAI;QAAGC,QAAQ,GAAIzB,MAAA,CAAA0B,gBAAgB,IAAG1B,MAAA,CAAA2B;SAAW,SAAO,iBAAAG,UAAA,E;;;;kFAI9FnC,mBAAA,CAIM,OAJNoC,UAIM,GAHJlC,YAAA,CAAwHmC,oBAAA;IAA7GC,IAAI,EAAC,SAAS;IAACC,KAAK,EAAL,EAAK;IAACC,KAAkC,EAAlC;MAAA;MAAA;IAAA,CAAkC;IAAEZ,OAAK,EAAEvB,MAAA,CAAAO,SAAS;gBAAWP,MAAA,CAAA2B,SAAS;+DAAT3B,MAAA,CAAA2B,SAAS,GAAAX,MAAA;;sBAAE,MAAE,C,iBAAF,IAAE,E;;qCAC5GK,mBAAA,kCAAqC,EACrCA,mBAAA,oFAAmF,C"},"metadata":{},"sourceType":"module","externalDependencies":[]}