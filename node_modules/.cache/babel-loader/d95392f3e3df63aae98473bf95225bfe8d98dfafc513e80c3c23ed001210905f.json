{"ast":null,"code":"import { ref, watchEffect } from 'vue';\nimport { ElMessage } from 'element-plus';\nimport axios from '@/utils/request';\nimport { useRouter } from 'vue-router';\nexport default {\n  __name: 'EvaluateDialog',\n  props: {\n    modelValue: Boolean,\n    QuestionId: Number\n  },\n  emits: ['update:modelValue'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const textarea = ref();\n    const value = ref();\n    const router = useRouter();\n    const emit = __emit;\n    const localDialogVisible = ref(props.modelValue);\n    watchEffect(() => {\n      if (localDialogVisible.value !== props.modelValue) {\n        emit('update:modelValue', localDialogVisible.value);\n      }\n    });\n\n    //对问答评价\n    async function evaluateAnswer() {\n      try {\n        const queryParams = new URLSearchParams({\n          id: props.QuestionId,\n          content: textarea.value,\n          grade: value.value\n        }).toString();\n        const response = await axios.post(`/answer/comment?${queryParams}`);\n        if (response.data.code === 1) {\n          ElMessage.success('评价成功');\n          localDialogVisible.value = false;\n          if (router.currentRoute.value.path === '/DefaultPresentation') {\n            location.reload();\n          } else {\n            router.push('/DefaultPresentation');\n          }\n        } else if (response.data.code === 0 && response.data.msg) {\n          ElMessage.error(response.data.msg.toString());\n        } else {\n          console.error(\"评价失败\");\n          ElMessage.error('评价失败');\n        }\n      } catch (error) {\n        console.error(\"评价失败\", error);\n        ElMessage.error('评价失败');\n      }\n    }\n    const __returned__ = {\n      props,\n      textarea,\n      value,\n      router,\n      emit,\n      localDialogVisible,\n      evaluateAnswer,\n      ref,\n      watchEffect,\n      get ElMessage() {\n        return ElMessage;\n      },\n      get axios() {\n        return axios;\n      },\n      get useRouter() {\n        return useRouter;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","watchEffect","ElMessage","axios","useRouter","props","__props","textarea","value","router","emit","__emit","localDialogVisible","modelValue","evaluateAnswer","queryParams","URLSearchParams","id","QuestionId","content","grade","toString","response","post","data","code","success","currentRoute","path","location","reload","push","msg","error","console"],"sources":["D:/有渔/前端源码/YouyuBBS-Q - 副本/youyu-lyn-qtnew-vision-new-2024.1.14/src/page/QACenter/components/EvaluateDialog.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <el-dialog v-model=\"localDialogVisible\" title=\"提问评价\">\r\n        <div class=\"eva_input\">\r\n            <el-input\r\n                v-model=\"textarea\"\r\n                maxlength=\"150\"\r\n                placeholder=\"分享一下最近的趣事或心情吧\"\r\n                show-word-limit\r\n                type=\"textarea\"\r\n                size=\"large\"\r\n                resize=\"none\"\r\n                :autosize = \"{ minRows: 2, maxRows: 30 }\"\r\n            />\r\n        </div>\r\n        <div class=\"rate_box\">\r\n            <span style=\"font-weight: 700;\">综合评价</span>\r\n            <el-rate v-model=\"value\" />\r\n        </div>\r\n        <template #footer>\r\n        <span class=\"dialog-footer\">\r\n            <el-button type=\"primary\" @click=\"evaluateAnswer\">\r\n            发布\r\n            </el-button>\r\n        </span>\r\n        </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref , defineProps ,defineEmits,watchEffect} from 'vue'\r\nimport { ElMessage } from 'element-plus';\r\nimport axios from '@/utils/request';\r\nimport { useRouter } from 'vue-router'\r\n\r\nconst props = defineProps({\r\n    modelValue: Boolean,\r\n    QuestionId:Number,\r\n});\r\n\r\nconst textarea = ref();\r\nconst value = ref();\r\nconst router = useRouter()\r\nconst emit = defineEmits(['update:modelValue']);\r\nconst localDialogVisible = ref(props.modelValue);\r\nwatchEffect(() => {\r\n  if (localDialogVisible.value !== props.modelValue) {\r\n    emit('update:modelValue', localDialogVisible.value);\r\n  }\r\n});\r\n\r\n//对问答评价\r\nasync function evaluateAnswer() {\r\n  try{\r\n    const queryParams = new URLSearchParams({\r\n      id:props.QuestionId,\r\n      content:textarea.value,\r\n      grade:value.value,\r\n    }).toString();\r\n    const response = await axios.post(`/answer/comment?${queryParams}`)\r\n    if(response.data.code === 1){\r\n        ElMessage.success('评价成功');\r\n        localDialogVisible.value = false;\r\n        if (router.currentRoute.value.path === '/DefaultPresentation') {\r\n          location.reload();\r\n        } else {\r\n          router.push('/DefaultPresentation');\r\n        }\r\n    }else if(response.data.code === 0 && response.data.msg){\r\n        ElMessage.error(response.data.msg.toString());\r\n    }else{\r\n        console.error(\"评价失败\");\r\n        ElMessage.error('评价失败');\r\n    }\r\n  } catch (error) {\r\n    console.error(\"评价失败\", error); \r\n    ElMessage.error('评价失败');\r\n  }\r\n}\r\n\r\n</script>\r\n<style scoped>\r\n::v-deep .el-dialog__body {\r\n  padding: 0px 40px;\r\n}\r\n::v-deep .el-dialog__header{\r\n  padding-bottom: 30px;\r\n  font-weight: 700;\r\n}\r\n::v-deep .el-input ,\r\n::v-deep .el-textarea,\r\n::v-deep .eva_input .el-textarea .el-textarea__inner{\r\n  width: 100%;\r\n  height: 170px !important;\r\n}\r\n::v-deep .el-dialog{\r\n    --el-dialog-width: 35%;\r\n}\r\n::v-deep .el-dialog__header{\r\n    text-align: center;\r\n}\r\n.rate_box{\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 20px;\r\n  margin: 20px 0px;\r\n}\r\n</style>\r\n"],"mappings":"AA+BA,SAASA,GAA8B,EAACC,WAAW,QAAO,KAAK;AAC/D,SAASC,SAAS,QAAQ,cAAc;AACxC,OAAOC,KAAK,MAAM,iBAAiB;AACnC,SAASC,SAAS,QAAQ,YAAY;;;;;;;;;;;;;IAEtC,MAAMC,KAAK,GAAGC,OAGZ;IAEF,MAAMC,QAAQ,GAAGP,GAAG,CAAC,CAAC;IACtB,MAAMQ,KAAK,GAAGR,GAAG,CAAC,CAAC;IACnB,MAAMS,MAAM,GAAGL,SAAS,CAAC,CAAC;IAC1B,MAAMM,IAAI,GAAGC,MAAkC;IAC/C,MAAMC,kBAAkB,GAAGZ,GAAG,CAACK,KAAK,CAACQ,UAAU,CAAC;IAChDZ,WAAW,CAAC,MAAM;MAChB,IAAIW,kBAAkB,CAACJ,KAAK,KAAKH,KAAK,CAACQ,UAAU,EAAE;QACjDH,IAAI,CAAC,mBAAmB,EAAEE,kBAAkB,CAACJ,KAAK,CAAC;MACrD;IACF,CAAC,CAAC;;IAEF;IACA,eAAeM,cAAcA,CAAA,EAAG;MAC9B,IAAG;QACD,MAAMC,WAAW,GAAG,IAAIC,eAAe,CAAC;UACtCC,EAAE,EAACZ,KAAK,CAACa,UAAU;UACnBC,OAAO,EAACZ,QAAQ,CAACC,KAAK;UACtBY,KAAK,EAACZ,KAAK,CAACA;QACd,CAAC,CAAC,CAACa,QAAQ,CAAC,CAAC;QACb,MAAMC,QAAQ,GAAG,MAAMnB,KAAK,CAACoB,IAAI,CAAE,mBAAkBR,WAAY,EAAC,CAAC;QACnE,IAAGO,QAAQ,CAACE,IAAI,CAACC,IAAI,KAAK,CAAC,EAAC;UACxBvB,SAAS,CAACwB,OAAO,CAAC,MAAM,CAAC;UACzBd,kBAAkB,CAACJ,KAAK,GAAG,KAAK;UAChC,IAAIC,MAAM,CAACkB,YAAY,CAACnB,KAAK,CAACoB,IAAI,KAAK,sBAAsB,EAAE;YAC7DC,QAAQ,CAACC,MAAM,CAAC,CAAC;UACnB,CAAC,MAAM;YACLrB,MAAM,CAACsB,IAAI,CAAC,sBAAsB,CAAC;UACrC;QACJ,CAAC,MAAK,IAAGT,QAAQ,CAACE,IAAI,CAACC,IAAI,KAAK,CAAC,IAAIH,QAAQ,CAACE,IAAI,CAACQ,GAAG,EAAC;UACnD9B,SAAS,CAAC+B,KAAK,CAACX,QAAQ,CAACE,IAAI,CAACQ,GAAG,CAACX,QAAQ,CAAC,CAAC,CAAC;QACjD,CAAC,MAAI;UACDa,OAAO,CAACD,KAAK,CAAC,MAAM,CAAC;UACrB/B,SAAS,CAAC+B,KAAK,CAAC,MAAM,CAAC;QAC3B;MACF,CAAC,CAAC,OAAOA,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,MAAM,EAAEA,KAAK,CAAC;QAC5B/B,SAAS,CAAC+B,KAAK,CAAC,MAAM,CAAC;MACzB;IACF"},"metadata":{},"sourceType":"module","externalDependencies":[]}