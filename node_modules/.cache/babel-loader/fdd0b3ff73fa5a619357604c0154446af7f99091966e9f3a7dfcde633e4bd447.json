{"ast":null,"code":"import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createBlock as _createBlock, createCommentVNode as _createCommentVNode, resolveDirective as _resolveDirective, withDirectives as _withDirectives, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nimport _imports_0 from '@/assets/MessageCenter/one.svg';\nconst _withScopeId = n => (_pushScopeId(\"data-v-75e4a398\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"first\"\n};\nconst _hoisted_2 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"one\"\n}, [/*#__PURE__*/_createElementVNode(\"img\", {\n  src: _imports_0,\n  alt: \"\"\n}), /*#__PURE__*/_createElementVNode(\"span\", null, \"系统通知\")], -1 /* HOISTED */));\nconst _hoisted_3 = {\n  class: \"then\",\n  \"infinite-scroll-distance\": \"100\",\n  \"infinite-scroll-immediate\": \"false\"\n};\nconst _hoisted_4 = {\n  style: {\n    \"display\": \"flex\",\n    \"justify-content\": \"space-between\",\n    \"margin-bottom\": \"20px\"\n  }\n};\nconst _hoisted_5 = {\n  class: \"title\"\n};\nconst _hoisted_6 = {\n  class: \"time\"\n};\nconst _hoisted_7 = {\n  class: \"content\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_checkbox = _resolveComponent(\"el-checkbox\");\n  const _component_el_empty = _resolveComponent(\"el-empty\");\n  const _directive_infinite_scroll = _resolveDirective(\"infinite-scroll\");\n  return _openBlock(), _createElementBlock(\"div\", null, [_createElementVNode(\"div\", _hoisted_1, [_hoisted_2, _createElementVNode(\"div\", null, [_createVNode(_component_el_checkbox, {\n    modelValue: $setup.checked1,\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.checked1 = $event),\n    label: \"网站通知\",\n    size: \"large\",\n    onChange: _ctx.change\n  }, null, 8 /* PROPS */, [\"modelValue\", \"onChange\"]), _createVNode(_component_el_checkbox, {\n    modelValue: $setup.checked2,\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.checked2 = $event),\n    label: \"审核通知\",\n    size: \"large\",\n    onChange: _ctx.change\n  }, null, 8 /* PROPS */, [\"modelValue\", \"onChange\"]), _createVNode(_component_el_checkbox, {\n    modelValue: $setup.checked3,\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.checked3 = $event),\n    label: \"举报通知\",\n    size: \"large\",\n    onChange: _ctx.change\n  }, null, 8 /* PROPS */, [\"modelValue\", \"onChange\"])])]), _withDirectives((_openBlock(), _createElementBlock(\"div\", _hoisted_3, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.systemNotification, (source, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: \"box\"\n    }, [_createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"span\", _hoisted_5, _toDisplayString(source.title), 1 /* TEXT */), _createElementVNode(\"span\", _hoisted_6, _toDisplayString(source.createTime), 1 /* TEXT */)]), _createElementVNode(\"div\", null, [_createElementVNode(\"p\", _hoisted_7, _toDisplayString(source.content), 1 /* TEXT */)])]);\n  }), 128 /* KEYED_FRAGMENT */)), $setup.systemNotification.length === 0 || !$setup.systemNotification ? (_openBlock(), _createBlock(_component_el_empty, {\n    key: 0,\n    \"image-size\": 200,\n    description: \"您暂时还没有收到系统消息呢！\"\n  })) : _createCommentVNode(\"v-if\", true)])), [[_directive_infinite_scroll, $setup.load]])]);\n}","map":{"version":3,"names":["_imports_0","class","_createElementVNode","src","alt","style","_createElementBlock","_hoisted_1","_hoisted_2","_createVNode","_component_el_checkbox","$setup","checked1","$event","label","size","onChange","_ctx","change","checked2","checked3","_hoisted_3","_Fragment","_renderList","systemNotification","source","index","key","_hoisted_4","_hoisted_5","_toDisplayString","title","_hoisted_6","createTime","_hoisted_7","content","length","_createBlock","_component_el_empty","description","load"],"sources":["D:\\有渔\\前端源码\\YouyuBBS-Q - 副本\\youyu-lyn-qtnew-vision-new-2024.1.14\\src\\page\\MessageCenter\\component\\SystemMessage\\SystemNote.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <div class=\"first\">\r\n            <div class=\"one\">\r\n                <img src=\"@/assets/MessageCenter/one.svg\" alt=\"\">\r\n                <span>系统通知</span>\r\n            </div>\r\n            <div>\r\n                <el-checkbox v-model=\"checked1\" label=\"网站通知\" size=\"large\" @change=\"change\"/>\r\n                <el-checkbox v-model=\"checked2\" label=\"审核通知\" size=\"large\" @change=\"change\"/>\r\n                <el-checkbox v-model=\"checked3\" label=\"举报通知\" size=\"large\" @change=\"change\"/>\r\n            </div>\r\n        </div>\r\n        <div class=\"then\" v-infinite-scroll=\"load\" infinite-scroll-distance=\"100\" infinite-scroll-immediate=\"false\">\r\n            <div v-for=\"(source,index) in systemNotification\" :key=\"index\" class=\"box\">\r\n                <div style=\"    display: flex;justify-content: space-between;margin-bottom: 20px;\">\r\n                    <span class=\"title\">{{ source.title }}</span>\r\n                    <span class=\"time\">{{ source.createTime }}</span>\r\n                </div>\r\n                <div>\r\n                    <p class=\"content\">{{ source.content }}</p>\r\n                </div>\r\n            </div>\r\n            <el-empty \r\n                v-if=\"systemNotification.length === 0  || !systemNotification\" \r\n                :image-size=\"200\" \r\n                description=\"您暂时还没有收到系统消息呢！\"\r\n            />\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\n    import { onMounted,ref,computed,watch } from 'vue';\r\n    import axios from '@/utils/request'\r\n    import { convertDateFormat } from '@/utils/timeFormat';\r\n    import { ElMessage } from 'element-plus';\r\n\r\n    const currentPage = ref(1);\r\n    const systemNotification = ref([]);\r\n    const checked1 = ref(true)\r\n    const checked2 = ref(true)\r\n    const checked3 = ref(true)\r\n    const types = computed(() => {\r\n        let tempTypes = [];\r\n        if (checked1.value) tempTypes.push(0);\r\n        if (checked2.value) tempTypes.push(1);\r\n        if (checked3.value) tempTypes.push(2);\r\n        return tempTypes;\r\n    });\r\n    const typeString = computed(() => {\r\n        return types.value.join(',');\r\n    });\r\n\r\n    // 这里的代码会在`type`变化时重新运行\r\n    watch(types, () => {\r\n        currentPage.value = 1; // 重置页码\r\n        systemNotification.value.splice(0, systemNotification.value.length);\r\n        getSystemNote(currentPage.value)\r\n    })\r\n\r\n    // 添加一个锁状态\r\n    let isLoading = false;\r\n    async function load() {\r\n        if (isLoading) return; // 如果已经在加载中，则直接返回不执行新的加载\r\n        isLoading = true; // 开始加载数据，设置锁状态为true\r\n        try {\r\n            if(currentPage.value === 1){\r\n                currentPage.value++;\r\n            }\r\n            await getSystemNote(currentPage.value);\r\n            currentPage.value++; // 只有在请求成功完成后才递增页码\r\n        } catch (error) {\r\n            console.error(error);\r\n            ElMessage.error('滚动时的未知错误');\r\n        } finally {\r\n            isLoading = false; // 请求完成，无论成功或失败，都释放锁状态\r\n        }\r\n    }\r\n\r\n    async function getSystemNote(currentPage) {\r\n        try {\r\n            const response = await axios.get('/notice/system', {\r\n                params: {\r\n                    type: typeString.value,\r\n                    page:currentPage,\r\n                    pageSize:10,\r\n                }\r\n            });\r\n            if (response.data.code === 1 && response.data.data.records.length > 0) {\r\n                const updates = response.data.data.records.map(async (record) => {\r\n                    const createTime = convertDateFormat(record.createTime);\r\n                    return { ...record, createTime };\r\n                });\r\n                const updatedRecords = await Promise.all(updates);\r\n                systemNotification.value = [...systemNotification.value, ...updatedRecords];\r\n                console.log(response.data.data);\r\n            }else if (response.data.code === 1 && response.data.data.records.length === 0) {\r\n                // ElMessage.info('已加载所有数据');\r\n            }else if(response.data.code === 0 && response.data.msg){\r\n                ElMessage.error(response.data.msg.toString());\r\n            }else(error)=>{\r\n                console.log(error);\r\n            }\r\n        } catch (error) {\r\n            console.log(error);\r\n        }\r\n    }\r\n\r\n    onMounted(()=>{\r\n        getSystemNote(currentPage.value);\r\n    })\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.first{\r\n    width: 77vw;\r\n    padding: 12px 12px 0px; \r\n    justify-content: center; \r\n    gap: 12px;\r\n    border-radius: 8px;\r\n    border: 2px solid #F0F0F0;\r\n    background: #FFF;\r\n    margin-top: 50px;\r\n}\r\n.one{\r\n    display: flex;\r\n    margin-bottom: 5px;\r\n    align-items: center;\r\n}\r\n.one img{\r\n    width: 20px;\r\n    height: 20px;\r\n}\r\n.one span{\r\n    color: #6B757B;\r\n    text-align: center;\r\n    font-weight: 700;\r\n    line-height: 1.6; \r\n    margin-left: 8px;\r\n}\r\n.then{\r\n    width: 77vw;\r\n    height: 72vh;\r\n    overflow-y: scroll;\r\n    padding: 12px 12px 0px;\r\n    border-radius: 8px;\r\n    border: 2px solid #F0F0F0;\r\n    margin-top: 12px;\r\n}\r\n.box{\r\n    width: 900px;\r\n    border-bottom: 1px solid #e7e7e7;\r\n    margin-bottom: 10px;\r\n    width: 95%;\r\n    min-height: 60px;\r\n    margin: 0 auto;\r\n    padding-left: 5px;\r\n    padding: 20px 5px;\r\n}\r\n.title{\r\n    color: #000;\r\n    text-align: center;\r\n    font-family: Microsoft YaHei;\r\n    font-size: 14px;\r\n    font-style: normal;\r\n    font-weight: 700;\r\n    line-height: 120%; \r\n}\r\n.time{\r\n    color: #A1A1A1;\r\n    font-size: 12px;\r\n    font-style: normal;\r\n    font-weight: 400;\r\n    line-height: 120%; \r\n    margin-left: 15px;\r\n}\r\n.content{\r\n    color: #505050;\r\n    font-family: Microsoft YaHei;\r\n    font-size: 14px;\r\n    font-style: normal;\r\n    font-weight: 400;\r\n    line-height: 120%; /* 16.8px */\r\n}\r\n::v-deep .el-checkbox.el-checkbox--large{\r\n    width: 80px;\r\n}\r\n@media (max-width: 768px) {\r\n    .first,\r\n    .then{\r\n        width: 800px;\r\n    }\r\n}\r\n</style>"],"mappings":";OAIqBA,UAAoC;;;EAF5CC,KAAK,EAAC;AAAO;gEACdC,mBAAA,CAGM;EAHDD,KAAK,EAAC;AAAK,I,aACZC,mBAAA,CAAiD;EAA5CC,GAAoC,EAApCH,UAAoC;EAACI,GAAG,EAAC;iBAC9CF,mBAAA,CAAiB,cAAX,MAAI,E;;EAQbD,KAAK,EAAC,MAAM;EAA0B,0BAAwB,EAAC,KAAK;EAAC,2BAAyB,EAAC;;;EAEvFI,KAA6E,EAA7E;IAAA;IAAA;IAAA;EAAA;AAA6E;;EACxEJ,KAAK,EAAC;AAAO;;EACbA,KAAK,EAAC;AAAM;;EAGfA,KAAK,EAAC;AAAS;;;;;uBAnBlCK,mBAAA,CA4BM,cA3BFJ,mBAAA,CAUM,OAVNK,UAUM,GATFC,UAGM,EACNN,mBAAA,CAIM,cAHFO,YAAA,CAA4EC,sBAAA;gBAAtDC,MAAA,CAAAC,QAAQ;+DAARD,MAAA,CAAAC,QAAQ,GAAAC,MAAA;IAAEC,KAAK,EAAC,MAAM;IAACC,IAAI,EAAC,OAAO;IAAEC,QAAM,EAAEC,IAAA,CAAAC;uDACnET,YAAA,CAA4EC,sBAAA;gBAAtDC,MAAA,CAAAQ,QAAQ;+DAARR,MAAA,CAAAQ,QAAQ,GAAAN,MAAA;IAAEC,KAAK,EAAC,MAAM;IAACC,IAAI,EAAC,OAAO;IAAEC,QAAM,EAAEC,IAAA,CAAAC;uDACnET,YAAA,CAA4EC,sBAAA;gBAAtDC,MAAA,CAAAS,QAAQ;+DAART,MAAA,CAAAS,QAAQ,GAAAP,MAAA;IAAEC,KAAK,EAAC,MAAM;IAACC,IAAI,EAAC,OAAO;IAAEC,QAAM,EAAEC,IAAA,CAAAC;0FAG3EZ,mBAAA,CAeM,OAfNe,UAeM,I,kBAdFf,mBAAA,CAQMgB,SAAA,QAAAC,WAAA,CARwBZ,MAAA,CAAAa,kBAAkB,GAAnCC,MAAM,EAACC,KAAK;yBAAzBpB,mBAAA,CAQM;MAR6CqB,GAAG,EAAED,KAAK;MAAEzB,KAAK,EAAC;QACjEC,mBAAA,CAGM,OAHN0B,UAGM,GAFF1B,mBAAA,CAA6C,QAA7C2B,UAA6C,EAAAC,gBAAA,CAAtBL,MAAM,CAACM,KAAK,kBACnC7B,mBAAA,CAAiD,QAAjD8B,UAAiD,EAAAF,gBAAA,CAA3BL,MAAM,CAACQ,UAAU,iB,GAE3C/B,mBAAA,CAEM,cADFA,mBAAA,CAA2C,KAA3CgC,UAA2C,EAAAJ,gBAAA,CAArBL,MAAM,CAACU,OAAO,iB;kCAIlCxB,MAAA,CAAAa,kBAAkB,CAACY,MAAM,WAAYzB,MAAA,CAAAa,kBAAkB,I,cADjEa,YAAA,CAIEC,mBAAA;;IAFG,YAAU,EAAE,GAAG;IAChBC,WAAW,EAAC;4EAbiB5B,MAAA,CAAA6B,IAAI,E"},"metadata":{},"sourceType":"module","externalDependencies":[]}