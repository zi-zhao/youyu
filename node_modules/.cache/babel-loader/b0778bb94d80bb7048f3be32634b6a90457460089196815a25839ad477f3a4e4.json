{"ast":null,"code":"import YyButton from \"@/page/components/YyButton.vue\";\nimport axios from '@/utils/request';\nimport { ElMessage } from 'element-plus';\nimport { ref } from 'vue';\nexport default {\n  __name: 'pwdChange',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const phone = ref();\n    const code = ref();\n    const password = ref();\n    const passworded = ref();\n    const time = ref(60);\n    const isRunning = ref(false);\n    const inner = ref('获取短信验证码');\n    const validate = () => {\n      if (!/^1[3-9]\\d{9}$/.test(phone.value)) {\n        ElMessage.error('手机号格式不正确');\n        return false;\n      }\n      if (!code.value) {\n        ElMessage.error('请输入验证码');\n        return false;\n      }\n      if (password.value.length < 6 || password.value.length > 15) {\n        ElMessage.error('密码必须是 6-15 个字符');\n        return false;\n      }\n      if (password.value !== passworded.value) {\n        ElMessage.error('两次输入的密码不一致');\n        return false;\n      }\n      return true;\n    };\n\n    // 点击发送验证码\n    async function startCountdown() {\n      time.value = 60; // 或者其他您需要的倒计时时间\n      isRunning.value = true;\n      sendPasswordSMSCodePhone();\n      inner.value = `${time.value}秒后重新获取`;\n      const timeId = setInterval(() => {\n        time.value--;\n        if (time.value === 0) {\n          clearInterval(timeId);\n          inner.value = '获取短信验证码';\n          isRunning.value = false;\n        } else {\n          inner.value = `${time.value}秒后重新获取`;\n        }\n      }, 1000);\n    }\n\n    //获取验证码的接口\n    async function sendPasswordSMSCodePhone() {\n      try {\n        const response = await axios.get(`/sendPasswordSMSCode/${phone.value}`);\n        if (response.data.code === 1) {\n          ElMessage.success('获取验证码成功');\n        } else if (response.data.code === 0 && response.data.msg) {\n          ElMessage.error(response.data.msg.toString());\n        } else {\n          console.error(\"获取验证码失败\");\n          ElMessage.error('获取验证码失败');\n        }\n      } catch (error) {\n        console.error(\"获取验证码失败\", error);\n        ElMessage.error('获取验证码失败');\n      }\n    }\n\n    //修改密码的接口\n    async function changePassword() {\n      try {\n        if (!validate()) {\n          return;\n        }\n        const response = await axios.put('/users/changePassword', {\n          password: password.value,\n          code: code.value\n        });\n        if (response.data.code === 1) {\n          ElMessage.success('修改密码成功');\n        } else if (response.data.code === 0 && response.data.msg) {\n          ElMessage.error(response.data.msg.toString());\n        } else {\n          console.error(\"修改密码失败\");\n          ElMessage.error('修改密码失败');\n        }\n      } catch (error) {\n        console.error(\"修改密码失败\", error);\n        ElMessage.error('修改密码失败');\n      }\n    }\n    const __returned__ = {\n      phone,\n      code,\n      password,\n      passworded,\n      time,\n      isRunning,\n      inner,\n      validate,\n      startCountdown,\n      sendPasswordSMSCodePhone,\n      changePassword,\n      YyButton,\n      get axios() {\n        return axios;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      ref\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["YyButton","axios","ElMessage","ref","phone","code","password","passworded","time","isRunning","inner","validate","test","value","error","length","startCountdown","sendPasswordSMSCodePhone","timeId","setInterval","clearInterval","response","get","data","success","msg","toString","console","changePassword","put"],"sources":["D:/有渔/前端源码/YouyuBBS-Q - 副本/youyu-lyn-qtnew-vision-new-2024.1.14/src/page/TheSettings/SecuLog/pwdChange.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <div class=\"out\">\r\n      <div class=\"title\">手机号</div>\r\n      <el-input  v-model=\"phone\" placeholder=\"请输入手机号\"/>\r\n    </div>\r\n    <div class=\"out\">\r\n      <div class=\"title\">身份验证</div>\r\n      <div class=\"input-bx\">\r\n        <el-input  v-model=\"code\" placeholder=\"请输入验证码\"/>\r\n        <YyButton theme=\"nobgc\" class=\"verify\" @click=\"startCountdown\" :disabled=\"!phone || isRunning\">{{ inner }}</YyButton>\r\n      </div>\r\n    </div>\r\n    <div class=\"out\">\r\n      <div class=\"title\">新密码</div>\r\n      <div class=\"input-bx\">\r\n        <el-input  type=\"password\" v-model=\"password\" show-password placeholder=\"请输入新密码\"/>\r\n      </div>\r\n    </div>\r\n    <div class=\"out\">\r\n      <div class=\"title\">确认密码</div>\r\n      <div class=\"input-bx\">\r\n        <el-input type=\"password\" v-model=\"passworded\"  show-password  placeholder=\"请确认密码\"/>\r\n      </div>\r\n    </div>\r\n    <div class=\"footer\">\r\n      <YyButton theme=\"purple\" @click=\"changePassword\">确认</YyButton>\r\n      <YyButton theme=\"gray\">取消</YyButton>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport YyButton from \"@/page/components/YyButton.vue\";\r\nimport axios from '@/utils/request';\r\nimport { ElMessage} from 'element-plus';\r\nimport { ref } from 'vue';\r\n\r\nconst phone = ref();\r\nconst code = ref();\r\nconst password = ref();\r\nconst passworded = ref();\r\nconst time = ref(60);\r\nconst isRunning = ref(false);\r\nconst inner = ref('获取短信验证码');\r\n\r\nconst validate = () => {\r\n  if (!/^1[3-9]\\d{9}$/.test(phone.value)) {\r\n    ElMessage.error('手机号格式不正确');\r\n    return false;\r\n  }\r\n  if (!code.value) {\r\n    ElMessage.error('请输入验证码');\r\n    return false;\r\n  }\r\n  if (password.value.length < 6 || password.value.length > 15) {\r\n    ElMessage.error('密码必须是 6-15 个字符');\r\n    return false;\r\n  }\r\n  if (password.value !== passworded.value) {\r\n    ElMessage.error('两次输入的密码不一致');\r\n    return false;\r\n  }\r\n  return true;\r\n};\r\n\r\n// 点击发送验证码\r\nasync function startCountdown() {\r\n  time.value = 60; // 或者其他您需要的倒计时时间\r\n  isRunning.value = true;\r\n  sendPasswordSMSCodePhone();\r\n  inner.value = `${time.value}秒后重新获取`;\r\n  const timeId = setInterval(() => {\r\n    time.value--;\r\n    if (time.value === 0) {\r\n      clearInterval(timeId);\r\n      inner.value = '获取短信验证码';\r\n      isRunning.value = false;\r\n    } else {\r\n      inner.value = `${time.value}秒后重新获取`;\r\n    }\r\n  }, 1000);\r\n}\r\n\r\n\r\n//获取验证码的接口\r\nasync function sendPasswordSMSCodePhone(){\r\n  try {\r\n    const response = await axios.get(`/sendPasswordSMSCode/${phone.value}`);\r\n    if(response.data.code === 1){\r\n      ElMessage.success('获取验证码成功');\r\n    }else if(response.data.code === 0 && response.data.msg){\r\n      ElMessage.error(response.data.msg.toString());\r\n    }else{\r\n      console.error(\"获取验证码失败\");\r\n      ElMessage.error('获取验证码失败');\r\n    }\r\n  } catch (error) {\r\n    console.error(\"获取验证码失败\", error); \r\n    ElMessage.error('获取验证码失败');\r\n  }\r\n}\r\n\r\n//修改密码的接口\r\nasync function changePassword(){\r\n  try {\r\n    if (!validate()) {\r\n      return;\r\n    }\r\n    const response = await axios.put('/users/changePassword',{\r\n      password:password.value,\r\n      code:code.value,\r\n    });\r\n    if(response.data.code === 1){\r\n      ElMessage.success('修改密码成功');\r\n    }else if(response.data.code === 0 && response.data.msg){\r\n      ElMessage.error(response.data.msg.toString());\r\n    }else{\r\n      console.error(\"修改密码失败\");\r\n      ElMessage.error('修改密码失败');\r\n    }\r\n  } catch (error) {\r\n    console.error(\"修改密码失败\", error); \r\n    ElMessage.error('修改密码失败');\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container{\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 3rem;\r\n}\r\n.out{\r\n  display: flex;\r\n  gap: 5rem;\r\n}\r\n\r\n.title{\r\n  font-size: 16px;\r\n  width: 65px;\r\n  color: #7D7979;\r\n}\r\n\r\n.input-bx{\r\n  width: 400px;\r\n  display: flex;\r\n  height: 35px;\r\n  gap: 2rem;\r\n}\r\n\r\n.footer{\r\n  display: flex;\r\n  justify-content: center;\r\n  gap: 2rem;\r\n  margin: 0 auto;\r\n}\r\n\r\n.verify{\r\n  width: 210px;\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}